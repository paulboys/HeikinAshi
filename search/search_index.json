{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"StockCharts Documentation","text":"<p>Welcome to the official documentation site for the StockCharts technical screening toolkit.</p>"},{"location":"#quick-navigation","title":"Quick Navigation","text":"<ul> <li>Overview: High-level architecture and purpose</li> <li>Heiken Ashi Screener: Color-based trend scan</li> <li>RSI Divergence Screener: Momentum disagreement detection</li> <li>Beta Regime Screener: Risk-on/risk-off market regime detection</li> <li>Parameters: All configurable flags</li> <li>Volume Filtering: Improve signal quality</li> <li>Trading Styles: Applying outputs to strategies</li> <li>Quick Reference: Command cheat sheet</li> <li>Roadmap: Planned enhancements</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install stockcharts\n</code></pre> <p>Development:</p> <pre><code>git clone https://github.com/paulboys/HeikinAshi.git\ncd HeikinAshi\npip install -e .\n</code></pre>"},{"location":"#cli-summary","title":"CLI Summary","text":"<pre><code>stockcharts-screen --color green --period 1d\nstockcharts-screen --min-run-percentile 90 --period 1d    # Extended runs\nstockcharts-rsi-divergence --type bullish --min-price 10\nstockcharts-plot-divergence --ticker NVDA --period 6mo\nstockcharts-beta-regime --regime risk-on                  # Beta regime scan\npython scripts/sector_regime.py                           # McGlone sector analysis\n</code></pre>"},{"location":"#key-concepts","title":"Key Concepts","text":"<ul> <li>Heiken Ashi: Smoothed candle representation for trend clarity.</li> <li>Run Statistics: <code>run_length</code> (current contiguous same-color count) and <code>run_percentile</code> (historical maturity gauge, 0\u2013100 inclusive).</li> <li>RSI Divergence: Price vs RSI swing mismatch signaling potential reversals.</li> <li>Beta Regime: Relative strength vs benchmark (SPY) to detect risk-on/risk-off conditions.</li> <li>McGlone Contrarian: 3-criteria buy system (risk-off + VIX spike + market correction).</li> <li>Precomputed Indices: Guarantee chart markers align with detected divergences.</li> <li>Tolerance: RSI difference threshold (0.5) to prevent noise.</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>Open issues or pull requests for feature requests, bug fixes, or doc improvements.</p>"},{"location":"#links","title":"Links","text":"<ul> <li>Source Code: https://github.com/paulboys/HeikinAshi</li> <li>PyPI: https://pypi.org/project/stockcharts/</li> </ul>"},{"location":"#api-reference","title":"API Reference","text":"<p>Auto-generated API docs are available under the API section of the navigation. Direct link: https://paulboys.github.io/HeikinAshi/api/</p>"},{"location":"#license","title":"License","text":"<p>MIT License. See repository root <code>LICENSE</code> file.</p>"},{"location":"DEPRECATION_NOTICE/","title":"Deprecation Notice (Legacy Markdown Cleanup)","text":""},{"location":"DEPRECATION_NOTICE/#summary","title":"Summary","text":"<p>Legacy standalone markdown documentation files at the repository root have been removed in favor of consolidated topical documents under <code>docs/</code>.</p>"},{"location":"DEPRECATION_NOTICE/#removed-files","title":"Removed Files","text":"<pre><code>DIVERGENCE_CHART_GUIDE.md\nDIVERGENCE_MODULE_SUMMARY.md\nDISTRIBUTION.md\nLIBRARY_COMPLETE.md\nLIBRARY_GUIDE.md\nPARAMETER_GUIDE.md\nPRECOMPUTED_DIVERGENCE_PATCH.md\nQUICK_REFERENCE.md\nRSI_DIVERGENCE_GUIDE.md\nRSI_TOLERANCE_GUIDE.md\nSCREENER_GUIDE.md\nSCREENER_IMPLEMENTATION.md\nTODO_NEXT_STEPS.md\nTRADING_STYLE_GUIDE.md\nVOLUME_FILTERING_GUIDE.md\nVOLUME_FILTER_SUMMARY.md\n</code></pre>"},{"location":"DEPRECATION_NOTICE/#replacement-mapping","title":"Replacement Mapping","text":"<p>See <code>docs/legacy.md</code> for the authoritative mapping from each legacy file to the new consolidated location: - Overview &amp; Architecture \u2192 <code>docs/overview.md</code> - Heiken Ashi Screener \u2192 <code>docs/screener.md</code> - RSI Divergence \u2192 <code>docs/rsi_divergence.md</code> - Parameters \u2192 <code>docs/parameters.md</code> - Volume Filtering \u2192 <code>docs/volume.md</code> - Trading Styles \u2192 <code>docs/trading_styles.md</code> - Quick Commands \u2192 <code>docs/quick_reference.md</code> - Roadmap / Next Steps \u2192 <code>docs/roadmap.md</code></p>"},{"location":"DEPRECATION_NOTICE/#rationale","title":"Rationale","text":"<ol> <li>Reduce duplication and drift.</li> <li>Improve discoverability via a single structured docs hub.</li> <li>Simplify maintenance and future enhancements.</li> </ol>"},{"location":"DEPRECATION_NOTICE/#guidance-for-consumers","title":"Guidance for Consumers","text":"<ul> <li>Update any external references (wikis, READMEs in downstream repos) to point to new <code>docs/</code> paths.</li> <li>If you pinned deep links to removed files, change them to consolidated equivalents.</li> </ul>"},{"location":"DEPRECATION_NOTICE/#version-tag-recommendation","title":"Version Tag Recommendation","text":"<p>Consider tagging a release before and after this cleanup: - <code>vX.Y.Z-legacy-docs</code> (last version with individual files) - <code>vX.Y.Z-docs-consolidated</code> (first version post-cleanup)</p>"},{"location":"DEPRECATION_NOTICE/#next-potential-improvements","title":"Next Potential Improvements","text":"<ul> <li>Add CHANGELOG entry summarizing documentation shift.</li> <li>Provide hosted documentation (e.g., GitHub Pages) generated from <code>docs/</code>.</li> </ul>"},{"location":"DEPRECATION_NOTICE/#contact","title":"Contact","text":"<p>For questions about this migration, open an issue referencing this notice.</p>"},{"location":"beta_regime/","title":"Beta Regime Analysis","text":"<p>The Beta Regime module helps identify market risk-on/risk-off conditions by analyzing the relative strength of individual stocks compared to a benchmark (typically SPY).</p>"},{"location":"beta_regime/#concept-overview","title":"Concept Overview","text":""},{"location":"beta_regime/#what-is-beta","title":"What is Beta?","text":"<p>Beta (\u03b2) measures the volatility of a stock relative to a benchmark index:</p> <p>$$\\beta = \\frac{\\text{Cov}(r_{\\text{asset}}, r_{\\text{benchmark}})}{\\text{Var}(r_{\\text{benchmark}})}$$</p> <ul> <li>\u03b2 &gt; 1: Stock is more volatile than the benchmark (amplifies market moves)</li> <li>\u03b2 &lt; 1: Stock is less volatile than the benchmark (dampens market moves)</li> <li>\u03b2 \u2248 1: Stock moves roughly in line with the benchmark</li> <li>\u03b2 &lt; 0: Stock moves inversely to the benchmark (rare for stocks)</li> </ul>"},{"location":"beta_regime/#relative-strength-regime-detection","title":"Relative Strength &amp; Regime Detection","text":"<p>The regime detection uses a relative strength ratio:</p> <p>$$RS = \\frac{\\text{Asset Price}}{\\text{Benchmark Price}}$$</p> <p>This ratio is then compared to its moving average:</p> <ul> <li>Risk-On: RS above its moving average \u2192 Asset outperforming benchmark</li> <li>Risk-Off: RS below its moving average \u2192 Asset underperforming benchmark</li> </ul>"},{"location":"beta_regime/#cli-commands","title":"CLI Commands","text":""},{"location":"beta_regime/#screen-for-beta-regime","title":"Screen for Beta Regime","text":"<pre><code># Screen all NASDAQ stocks\nstockcharts-beta-regime\n\n# Filter for risk-on stocks only\nstockcharts-beta-regime --regime risk-on\n\n# Screen weekly charts against QQQ benchmark\nstockcharts-beta-regime --benchmark QQQ --interval 1wk\n\n# Apply price and volume filters\nstockcharts-beta-regime --min-price 10 --max-price 100 --min-volume 500000\n\n# Save results to CSV\nstockcharts-beta-regime --output results.csv\n</code></pre>"},{"location":"beta_regime/#plot-beta-regime-chart","title":"Plot Beta Regime Chart","text":"<pre><code># Plot a single ticker\nstockcharts-plot-beta AAPL\n\n# Compare against QQQ instead of SPY\nstockcharts-plot-beta AAPL --benchmark QQQ\n\n# Use weekly interval with custom MA period\nstockcharts-plot-beta AAPL --interval 1wk --ma-period 40\n\n# Save chart to file\nstockcharts-plot-beta AAPL --output aapl_beta.png\n</code></pre>"},{"location":"beta_regime/#python-api","title":"Python API","text":""},{"location":"beta_regime/#analyze-a-single-ticker","title":"Analyze a Single Ticker","text":"<pre><code>from stockcharts.indicators.beta import analyze_beta_regime\nfrom stockcharts.data.fetch import fetch_ohlc\n\n# Fetch data\nasset_df = fetch_ohlc(\"AAPL\", lookback=\"2y\")\nbenchmark_df = fetch_ohlc(\"SPY\", lookback=\"2y\")\n\n# Analyze regime\nresult = analyze_beta_regime(\n    asset_df,\n    benchmark_df,\n    ma_period=200,\n    beta_window=60\n)\n\nprint(f\"Regime: {result['regime']}\")\nprint(f\"Relative Strength: {result['rs_current']:.4f}\")\nprint(f\"200 MA: {result['rs_ma_current']:.4f}\")\nprint(f\"% from MA: {result['pct_from_ma']:.2%}\")\nprint(f\"Beta: {result['beta']:.2f}\")\n</code></pre>"},{"location":"beta_regime/#screen-multiple-tickers","title":"Screen Multiple Tickers","text":"<pre><code>from stockcharts.screener.beta_regime import screen_beta_regime, save_results_to_csv\n\n# Screen all NASDAQ for risk-on stocks\nresults = screen_beta_regime(\n    benchmark=\"SPY\",\n    regime_filter=\"risk-on\",\n    min_price=10,\n    min_volume=500000,\n    verbose=True\n)\n\n# Display results\nfor r in results[:10]:\n    print(f\"{r.ticker}: {r.regime} (RS: {r.relative_strength:.4f}, \u03b2: {r.beta:.2f})\")\n\n# Save to CSV\nsave_results_to_csv(results, \"risk_on_stocks.csv\")\n</code></pre>"},{"location":"beta_regime/#compute-raw-beta","title":"Compute Raw Beta","text":"<pre><code>from stockcharts.indicators.beta import compute_rolling_beta\nfrom stockcharts.data.fetch import fetch_ohlc\n\nasset_df = fetch_ohlc(\"AAPL\", lookback=\"2y\")\nbenchmark_df = fetch_ohlc(\"SPY\", lookback=\"2y\")\n\n# 60-day rolling beta\nbeta = compute_rolling_beta(\n    asset_df[\"Close\"],\n    benchmark_df[\"Close\"],\n    window=60\n)\n\nprint(f\"Current 60-day Beta: {beta.iloc[-1]:.2f}\")\n</code></pre>"},{"location":"beta_regime/#parameters","title":"Parameters","text":""},{"location":"beta_regime/#screener-parameters","title":"Screener Parameters","text":"Parameter Default Description <code>benchmark</code> \"SPY\" Benchmark ticker (SPY, QQQ, etc.) <code>interval</code> \"1d\" Candle interval: \"1d\", \"1wk\", \"1mo\" <code>ma_period</code> 200 Moving average period for regime detection <code>beta_window</code> 60 Rolling window for beta calculation <code>regime_filter</code> \"all\" Filter: \"risk-on\", \"risk-off\", \"all\" <code>min_price</code> None Minimum stock price filter <code>max_price</code> None Maximum stock price filter <code>min_volume</code> None Minimum average volume filter <code>batch_size</code> 50 Tickers per batch download"},{"location":"beta_regime/#auto-adjustment-for-weekly-interval","title":"Auto-Adjustment for Weekly Interval","text":"<p>When using <code>--interval 1wk</code> with <code>ma_period=200</code>, the period automatically adjusts to 40 weeks (equivalent to ~200 trading days).</p>"},{"location":"beta_regime/#trading-applications","title":"Trading Applications","text":""},{"location":"beta_regime/#risk-on-screening","title":"Risk-On Screening","text":"<p>Find stocks that are outperforming the market:</p> <pre><code>stockcharts-beta-regime --regime risk-on --min-volume 1000000\n</code></pre> <p>These stocks are showing relative strength and may continue to outperform.</p>"},{"location":"beta_regime/#risk-off-screening","title":"Risk-Off Screening","text":"<p>Find stocks that are underperforming:</p> <pre><code>stockcharts-beta-regime --regime risk-off --min-price 20\n</code></pre> <p>These stocks are showing relative weakness; consider for mean-reversion or avoiding longs.</p>"},{"location":"beta_regime/#combining-with-other-signals","title":"Combining with Other Signals","text":"<p>Use beta regime as a filter with RSI divergence:</p> <pre><code>from stockcharts.screener.beta_regime import screen_beta_regime\nfrom stockcharts.screener.rsi_divergence import screen_rsi_divergence\n\n# First find risk-off stocks (underperforming)\nweak_stocks = screen_beta_regime(regime_filter=\"risk-off\", verbose=False)\nweak_tickers = [r.ticker for r in weak_stocks]\n\n# Then check for bullish divergences (potential reversal)\ndivergences = screen_rsi_divergence(\n    tickers=weak_tickers,\n    divergence_type=\"bullish\",\n    verbose=True\n)\n</code></pre>"},{"location":"beta_regime/#output-fields","title":"Output Fields","text":""},{"location":"beta_regime/#betaregimeresult","title":"BetaRegimeResult","text":"Field Type Description <code>ticker</code> str Stock symbol <code>company_name</code> str Company name <code>benchmark</code> str Benchmark used <code>regime</code> str \"risk-on\" or \"risk-off\" <code>relative_strength</code> float Current RS ratio <code>ma_value</code> float RS moving average value <code>pct_from_ma</code> float Percentage distance from MA <code>beta</code> float Rolling beta value <code>close_price</code> float Current close price <code>benchmark_price</code> float Current benchmark price <code>interval</code> str Time interval used <code>ma_period</code> int MA period used ## McGlone Contrarian Sector Analysis <p>The <code>scripts/sector_regime.py</code> script implements Mike McGlone's contrarian framework for timing equity sector entry.</p>"},{"location":"beta_regime/#mcglones-3-criteria-buy-system","title":"McGlone's 3-Criteria Buy System","text":"<p>Mike McGlone (Bloomberg Intelligence) advocates a contrarian approach:</p> <ol> <li>Beta below 200-day MA (Risk-Off regime) - Sector underperforming SPY</li> <li>VIX spike to 30-40 - Fear at extreme levels</li> <li>Market correction \u2265 10% - Prices discounted from 52-week highs</li> </ol> <p>BUY signal = All 3 conditions met (capitulation complete)</p>"},{"location":"beta_regime/#signal-types","title":"Signal Types","text":"Signal Meaning Action <code>BUY</code> All 3 conditions met Enter positions - capitulation complete <code>WATCH_BUY</code> 2/3 conditions met Prepare to buy, wait for final trigger <code>ACCUMULATE</code> Risk-off + pullback (5-10%) Scale in slowly <code>WATCH</code> Deep risk-off (&gt;10% below MA) Approaching buy zone <code>WAIT</code> Risk-off but no capitulation Patient - no action yet <code>HOLD</code> Risk-on uptrend Hold existing positions <code>EXTENDED</code> Far above MA (&gt;15%) Risky to chase <code>NEUTRAL</code> No clear signal No action"},{"location":"beta_regime/#usage","title":"Usage","text":"<pre><code># Analyze 11 S&amp;P 500 GICS sectors\npython scripts/sector_regime.py\n\n# Industry sub-sectors (XBI, KRE, XHB, etc.)\npython scripts/sector_regime.py --industries\n\n# SmallCap sector ETFs (PSC* series)\npython scripts/sector_regime.py --smallcap\n\n# Leveraged Bull/Bear ETFs (2x/3x)\npython scripts/sector_regime.py --leveraged\n\n# Sectors + Industries combined\npython scripts/sector_regime.py --all\n\n# All 90+ ETFs comprehensive\npython scripts/sector_regime.py --comprehensive\n</code></pre>"},{"location":"beta_regime/#available-etf-categories","title":"Available ETF Categories","text":"Category Count Examples S&amp;P 500 GICS Sectors 11 XLK, XLF, XLE, XLV, XLI, etc. S&amp;P 500 Industries 18 XBI, KRE, XHB, XRT, XOP, etc. SmallCap Sectors 9 PSCT, PSCF, PSCE, PSCH, etc. iShares Sectors 4 IGM, IGV, IGE, IYT Leveraged Bull (2x/3x) 24 TECL, FAS, ERX, LABU, etc. Leveraged Bear (2x/3x) 18 TECS, FAZ, ERY, LABD, etc. Thematic 6 PILL, TEXU, etc."},{"location":"beta_regime/#example-output","title":"Example Output","text":"<pre><code>===============================================================================\nMARKET CONDITIONS (McGlone's 3 Criteria)\n-------------------------------------------------------------------------------\n  [ ] VIX Spike (&gt;=30):     VIX = 20.4 (ELEVATED) -&gt; NO\n  [ ] Correction (&gt;=-10%): SPY = $595.23, Drawdown = -1.0% (NEAR_HIGHS) -&gt; NO\n  [ ] Risk-Off Regime:   (See sector analysis below)\n\n  MARKET-LEVEL: 0/2 macro conditions met\n     WAIT - No capitulation signals yet\n\n===============================================================================\nS&amp;P 500 GICS SECTORS - McGlone Contrarian Analysis\n===============================================================================\n\nSector/Industry      ETF   Beta  Regime   %FromMA  Signal       Action\n-------------------------------------------------------------------------------\nUtilities            XLU    0.45 - risk-off   -4.2% WAIT\nMaterials            XLB    1.12 - risk-off   -2.8% WAIT\nEnergy               XLE    1.25 + risk-on    +3.5% NEUTRAL\nTechnology           XLK    1.35 + risk-on   +12.1% HOLD          \nFinancials           XLF    1.10 + risk-on   +18.5% EXTENDED      !\n</code></pre>"},{"location":"beta_regime/#integration-with-beta-regime-screener","title":"Integration with Beta Regime Screener","text":"<p>The sector regime script uses the same underlying <code>screen_beta_regime()</code> function with optimized defaults for McGlone's methodology:</p> <ul> <li>Period: 10 years (stable relative strength history)</li> <li>Interval: Weekly (<code>1wk</code>) with 40-bar MA (\u2248200 daily bars)</li> <li>Benchmark: SPY</li> </ul> <pre><code>from stockcharts.screener.beta_regime import screen_beta_regime\n\n# Run the same analysis programmatically\nresults = screen_beta_regime(\n    tickers=[\"XLK\", \"XLF\", \"XLE\", \"XLV\", \"XLI\"],\n    interval=\"1wk\",\n    lookback=\"10y\",\n    regime_filter=\"all\",\n)\n\nfor r in results:\n    print(f\"{r.ticker}: {r.regime} ({r.pct_from_ma:+.1f}%)\")\n</code></pre>"},{"location":"contributing/","title":"Contributing Guide","text":"<p>Thank you for contributing to StockCharts! This guide outlines our expectations to keep the codebase stable, testable, and well-documented.</p>"},{"location":"contributing/#development-workflow","title":"Development Workflow","text":"<ul> <li>Create a feature branch from <code>main</code>.</li> <li>Write tests first for new logic (unit tests), then integration tests for CLI flows.</li> <li>Keep changes minimal and focused; avoid unrelated refactors.</li> <li>Update docs and changelog when you add user-facing features.</li> </ul>"},{"location":"contributing/#testing","title":"Testing","text":"<ul> <li>Run <code>pytest</code> locally. CI runs tests with coverage.</li> <li>Unit tests: focus on pure functions like <code>indicators/divergence.py</code> and <code>indicators/pivots.py</code>.</li> <li>Integration tests: validate CLI commands (<code>stockcharts-rsi-divergence</code>, <code>stockcharts-plot-divergence</code>) using temp files.</li> <li>Mock external services (e.g., yfinance) using <code>pytest-mock</code> or <code>responses</code>.</li> </ul>"},{"location":"contributing/#style-structure","title":"Style &amp; Structure","text":"<ul> <li>Follow existing code style; no large reformatting.</li> <li>Prefer composition and small helpers over deep inheritance.</li> <li>Keep fixtures under <code>tests/fixtures/</code>; examples belong in <code>examples/</code>.</li> </ul>"},{"location":"contributing/#documentation","title":"Documentation","text":"<ul> <li>Update <code>docs/</code> and <code>mkdocs.yml</code> for new flags or features.</li> <li>Add usage examples and \u201cTry it\u201d commands.</li> <li>Build docs locally: <code>mkdocs build</code>.</li> </ul>"},{"location":"contributing/#pull-request-checklist","title":"Pull Request Checklist","text":"<ul> <li>[ ] Tests added/updated (unit and/or integration)</li> <li>[ ] Docs updated in <code>docs/</code></li> <li>[ ] Changelog entry added (if user-facing)</li> <li>[ ] CI passes locally (<code>pytest</code>, <code>mkdocs build --strict</code>)</li> </ul>"},{"location":"contributing/#releasing","title":"Releasing","text":"<ul> <li>Semantic versioning (MAJOR.MINOR.PATCH): Breaking changes bump major, features bump minor, fixes bump patch.</li> <li>Single source of truth: Version is defined only in <code>pyproject.toml</code>. The package reads it via <code>importlib.metadata</code>.</li> <li>To bump version: Edit <code>version = \"X.Y.Z\"</code> in <code>pyproject.toml</code> only. Do not edit <code>__init__.py</code>.</li> <li>Tag releases with <code>git tag vX.Y.Z</code> after merging; PyPI publish is handled via GitHub Actions.</li> <li>Verify version: <code>python -c \"from stockcharts import __version__; print(__version__)\"</code> or <code>stockcharts-screen --version</code>.</li> </ul>"},{"location":"contributing/#questions","title":"Questions","text":"<p>Open a GitHub issue or start a discussion. We appreciate your help!</p>"},{"location":"copilot/","title":"Copilot Guide","text":"<p>This project welcomes AI assistance to accelerate development while maintaining quality. Use these prompt patterns and expectations.</p>"},{"location":"copilot/#prompt-patterns","title":"Prompt Patterns","text":"<ul> <li>\"Write unit tests for <code>indicators/divergence.py</code> covering 2- and 3-point cases. Use small synthetic OHLC fixtures.\"</li> <li>\"Create integration tests for <code>stockcharts-rsi-divergence</code> CLI that write outputs to a temp dir and validate CSV headers. Mock yfinance downloads.\"</li> <li>\"Add MkDocs section to <code>docs/index.md</code> showing 'Try It' commands for screening and plotting.\"</li> <li>\"Refactor helper functions in <code>pivots.py</code> to improve testability without changing public APIs.\"</li> </ul>"},{"location":"copilot/#expectations","title":"Expectations","text":"<ul> <li>Tests first: propose tests, then implement minimal code to pass.</li> <li>Mock external services: do not perform network calls in tests.</li> <li>Keep patches surgical: avoid formatting unrelated files.</li> <li>Update docs when adding flags or changing behavior.</li> </ul>"},{"location":"copilot/#common-mocks","title":"Common Mocks","text":"<ul> <li><code>yfinance.download</code>: return a deterministic DataFrame with columns <code>Open,High,Low,Close,Volume</code>.</li> <li>File system: use <code>tempfile.TemporaryDirectory()</code> in tests; avoid writing outside temp paths.</li> </ul>"},{"location":"copilot/#checklists","title":"Checklists","text":"<ul> <li>[ ] Unit tests added</li> <li>[ ] Integration tests added/mocked</li> <li>[ ] Docs updated</li> <li>[ ] CI passes locally</li> </ul>"},{"location":"copilot/#useful-commands","title":"Useful Commands","text":"<pre><code>pytest -q --maxfail=1 --disable-warnings\nmkdocs build --strict\nmkdocs serve\n</code></pre>"},{"location":"disclaimer/","title":"Disclaimer","text":"<p>This project (<code>stockcharts</code>) and all generated outputs (screen results, charts, divergence annotations) are provided for informational and educational purposes only.</p>"},{"location":"disclaimer/#no-financial-advice","title":"No Financial Advice","text":"<p>Nothing herein constitutes investment, trading, legal, tax, or other professional advice. Validate all signals independently. If you need personalized guidance, consult a licensed financial professional.</p>"},{"location":"disclaimer/#risk","title":"Risk","text":"<p>Trading and investing involve risk of loss including principal. Past patterns or detected divergences do not guarantee future outcomes. Data (prices, volume) may be delayed, incomplete, or contain inaccuracies.</p>"},{"location":"disclaimer/#reliability-warranty","title":"Reliability &amp; Warranty","text":"<p>Signals (e.g. RSI divergences, Heiken Ashi color changes) may produce false positives/negatives. The software is provided \"AS IS\" without warranties of any kind. Refer to the MIT License for full terms.</p>"},{"location":"disclaimer/#liability","title":"Liability","text":"<p>You assume full responsibility for any actions taken based on this software. By using it, you agree to indemnify the author(s) against claims arising from its use.</p>"},{"location":"disclaimer/#how-to-suppress-cli-banner","title":"How To Suppress CLI Banner","text":"<p>Add the environment variable:</p> <pre><code>set STOCKCHARTS_NO_DISCLAIMER=1   # Windows PowerShell\n</code></pre> <p>or run commands with <code>--no-disclaimer</code> to skip the one-line reminder.</p> <p>For the full text see <code>DISCLAIMER.md</code> in the repository root.</p>"},{"location":"legacy/","title":"Legacy Documentation Map","text":"<p>Original markdown files retained for historical reference. Their content has been consolidated into the new <code>docs/</code> structure.</p> Legacy File New Location README.md docs/overview.md (summary) DISTRIBUTION.md docs/overview.md (packaging section) LIBRARY_GUIDE.md docs/overview.md (architecture) LIBRARY_COMPLETE.md docs/overview.md (extended notes) QUICK_REFERENCE.md docs/quick_reference.md SCREENER_GUIDE.md docs/screener.md SCREENER_IMPLEMENTATION.md docs/screener.md (implementation) TRADING_STYLE_GUIDE.md docs/trading_styles.md RSI_DIVERGENCE_GUIDE.md docs/rsi_divergence.md DIVERGENCE_MODULE_SUMMARY.md docs/rsi_divergence.md (workflow) DIVERGENCE_CHART_GUIDE.md docs/rsi_divergence.md (plotting section) PRECOMPUTED_DIVERGENCE_PATCH.md docs/rsi_divergence.md (precomputed indices) RSI_TOLERANCE_GUIDE.md docs/rsi_divergence.md (tolerance section) PARAMETER_GUIDE.md docs/parameters.md VOLUME_FILTERING_GUIDE.md docs/volume.md VOLUME_FILTER_SUMMARY.md docs/volume.md TODO_NEXT_STEPS.md docs/roadmap.md TRADING_STYLE_GUIDE.md docs/trading_styles.md"},{"location":"legacy/#guidance","title":"Guidance","text":"<p>Keep legacy files for a few commits; remove or archive once consumers migrate.</p>"},{"location":"legacy/#removal-strategy-optional","title":"Removal Strategy (Optional)","text":"<ol> <li>Tag release before deletion.</li> <li>Remove legacy root markdown files.</li> <li>Update README references.</li> <li>Communicate change in CHANGELOG.</li> </ol>"},{"location":"legacy/#suggestion","title":"Suggestion","text":"<p>Add a short deprecation banner at top of each legacy file if removal planned.</p>"},{"location":"overview/","title":"StockCharts Overview","text":""},{"location":"overview/#purpose","title":"Purpose","text":"<p>StockCharts is a Python library and CLI toolkit for screening and visualizing technical setups (Heiken Ashi trends, RSI price divergences) across NASDAQ equities using reproducible programmatic workflows.</p>"},{"location":"overview/#core-capabilities","title":"Core Capabilities","text":"<ul> <li>Heiken Ashi candle color + run statistics screener (trend snapshot + maturity)</li> <li>RSI price divergence screener (potential reversal detection)</li> <li>Beta regime screener (risk-on/risk-off market regime detection)</li> <li>McGlone contrarian sector analysis (90+ ETFs with 3-criteria buy signals)</li> <li>Chart generation (price + RSI with divergence markers, Heiken Ashi visualization)</li> <li>Batch data retrieval via <code>yfinance</code></li> <li>Filtering by price, volume, divergence type, candle color, run percentile</li> <li>Precomputed indices to guarantee chart-plot alignment</li> </ul>"},{"location":"overview/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>stockcharts/\n  data/         # Data acquisition (yfinance wrappers)\n  indicators/   # Indicator + divergence logic (RSI, divergence detection)\n  screener/     # Screeners (Heiken Ashi, RSI divergence)\n  charts/       # Plotting utilities (price/RSI, Heiken Ashi)\n  cli.py        # Unified CLI entry points\n</code></pre>"},{"location":"overview/#installation","title":"Installation","text":"<pre><code>pip install -e .\n</code></pre> <p>(or add to requirements and <code>pip install -r requirements.txt</code>)</p>"},{"location":"overview/#cli-commands","title":"CLI Commands","text":"<ul> <li><code>stockcharts-screen</code> (Heiken Ashi color screener)</li> <li><code>stockcharts-rsi-divergence</code> (RSI divergence screener)</li> <li><code>stockcharts-beta-regime</code> (risk-on/risk-off regime screener)</li> <li><code>stockcharts-plot</code> (generic price/indicator plot)</li> <li><code>stockcharts-plot-divergence</code> (price + RSI divergence visualization)</li> </ul> <p>See <code>docs/screener.md</code>, <code>docs/rsi_divergence.md</code>, and <code>docs/beta_regime.md</code> for detailed usage.</p>"},{"location":"overview/#quick-reference","title":"Quick Reference","text":"<p>Common tasks:</p> <pre><code>stockcharts-screen --color green --period 1d\nstockcharts-screen --min-run-percentile 90 --period 1d\nstockcharts-rsi-divergence --type bullish --min-price 10 --period 6mo\nstockcharts-plot-divergence --ticker AAPL --period 6mo\n</code></pre> <p>More shortcuts in <code>docs/quick_reference.md</code>.</p>"},{"location":"overview/#distribution-packaging-notes","title":"Distribution &amp; Packaging Notes","text":"<ul> <li>Project uses <code>pyproject.toml</code> (PEP 621) for build metadata.</li> <li>Entry points expose CLI commands.</li> <li>Versioning follows semantic increments (feature additions: minor; fixes: patch).</li> <li>Internal modules avoid heavy dependencies (core: pandas, numpy, matplotlib, yfinance).</li> </ul>"},{"location":"overview/#design-principles","title":"Design Principles","text":"<ul> <li>Deterministic screening (consistent output for same parameters/time)</li> <li>Readable, dataclass-based result objects (including run statistics)</li> <li>Minimal, explicit parameters (price, volume, lookback, period)</li> <li>Separation of concerns (fetch vs analyze vs visualize)</li> </ul>"},{"location":"overview/#roadmap-snapshot","title":"Roadmap Snapshot","text":"<p>See <code>docs/roadmap.md</code> for detailed upcoming enhancements.</p>"},{"location":"overview/#when-to-use-this-library","title":"When to Use This Library","text":"<p>Use StockCharts when you need fast, scriptable screening plus immediate chart validation\u2014especially for workflow automation or nightly scans.</p>"},{"location":"parameters/","title":"Parameters &amp; Configuration","text":""},{"location":"parameters/#price-filters","title":"Price Filters","text":"<ul> <li><code>--min-price</code> / <code>--max-price</code> narrow universe to viable capital ranges.</li> <li>Avoid illiquid penny stocks with <code>--min-price 5</code> or <code>10</code>.</li> </ul>"},{"location":"parameters/#volume-filter-rsi-divergence","title":"Volume Filter (RSI Divergence)","text":"<ul> <li><code>--min-volume N</code> ensures recent average volume (last bar) exceeds threshold.</li> <li>Helps eliminate thinly traded noise setups.</li> </ul>"},{"location":"parameters/#rsi-settings","title":"RSI Settings","text":"<ul> <li><code>--rsi-period</code> (default 14). Lower values (9) increase sensitivity; higher (21) smooth.</li> <li>Consider longer period for weekly scans.</li> </ul>"},{"location":"parameters/#swing-window","title":"Swing Window","text":"<ul> <li><code>--swing-window</code> controls local extremum detection width.</li> <li>Larger window = fewer, more significant swing points.</li> </ul>"},{"location":"parameters/#lookback","title":"Lookback","text":"<ul> <li><code>--lookback</code> bars to search for last two qualifying swings.</li> <li>Typical range: 50\u201380 for daily; can expand for weekly.</li> </ul>"},{"location":"parameters/#aggregation-period","title":"Aggregation Period","text":"<ul> <li><code>--period</code> sets candle aggregation size: <code>1d</code>, <code>1wk</code>, <code>1mo</code>.</li> <li>Choose higher timeframe (<code>1wk</code>) for broader context; lower (<code>1d</code>) for tactical entries.</li> </ul>"},{"location":"parameters/#historical-span","title":"Historical Span","text":"<ul> <li><code>--lookback</code> defines the data history window fetched: <code>1mo</code>, <code>3mo</code>, <code>6mo</code>, <code>1y</code>, etc.</li> <li>Must be sufficient to compute indicators and run statistics (include enough prior runs).</li> </ul>"},{"location":"parameters/#tolerance","title":"Tolerance","text":"<ul> <li>Fixed RSI tolerance (0.5) ensures meaningful divergence.</li> <li>Adjustable in <code>divergence.py</code> if needed.</li> </ul>"},{"location":"parameters/#input-filter","title":"Input Filter","text":"<ul> <li><code>--input-filter FILE</code> loads tickers from a previous screener CSV to intersect signals.</li> <li>Enables multi-factor workflows (e.g., green HA AND bullish divergence).</li> </ul>"},{"location":"parameters/#output","title":"Output","text":"<ul> <li><code>--output FILE</code> writes results to CSV.</li> <li>For reproducibility, include parameters in filename (e.g., <code>div_bullish_6mo_tol0.5.csv</code>).</li> </ul>"},{"location":"parameters/#delay-ha-screener","title":"Delay (HA Screener)","text":"<ul> <li><code>--delay</code> controls per-ticker pause for yfinance.</li> <li>Reduce cautiously (risk rate limiting).</li> </ul>"},{"location":"parameters/#quiet-mode","title":"Quiet Mode","text":"<ul> <li><code>--quiet</code> suppresses progress logging for cleaner automation output.</li> </ul>"},{"location":"parameters/#recommended-combos","title":"Recommended Combos","text":"<ul> <li>Momentum exhaustion: <code>--type bearish --min-price 50 --min-volume 2_000_000</code></li> <li>Reversal scan: <code>--type bullish --swing-window 7 --rsi-period 21</code></li> <li>Liquidity focus: <code>--min-volume 5_000_000 --min-price 10</code></li> <li>Extended HA runs: <code>--min-run-percentile 90 --period 1d</code></li> <li>Early HA runs for continuation: <code>--max-run-percentile 25 --period 1d</code></li> </ul>"},{"location":"parameters/#extended-terminology-guide-merged","title":"Extended Terminology Guide (Merged)","text":""},{"location":"parameters/#aggregation-period-period","title":"Aggregation Period (<code>--period</code>)","text":"<p>Defines candle size: <code>1d</code>, <code>1wk</code>, <code>1mo</code> (replaces earlier <code>--interval</code>).</p>"},{"location":"parameters/#time-window-lookback","title":"Time Window (<code>--lookback</code>)","text":"<p>Historical span fetched: <code>1mo</code>, <code>3mo</code>, <code>6mo</code>, <code>1y</code>, <code>2y</code>, <code>5y</code>.</p>"},{"location":"parameters/#explicit-date-range-start-end","title":"Explicit Date Range (<code>--start</code> / <code>--end</code>)","text":"<p>Overrides lookback when both provided; format YYYY-MM-DD.</p>"},{"location":"parameters/#example-commands","title":"Example Commands","text":"<pre><code>stockcharts-screen --color green --period 1d --lookback 3mo --output green_reversals.csv\nstockcharts-screen --color green --period 1wk --lookback 1y --output weekly_reversals.csv\nstockcharts-screen --color green --period 1d --start 2024-01-01 --end 2024-12-31\nstockcharts-screen --min-run-percentile 90 --period 1d --lookback 6mo --output extended_runs.csv\nstockcharts-screen --max-run-percentile 25 --period 1d --lookback 3mo --output early_runs.csv\n</code></pre>"},{"location":"parameters/#common-mistakes","title":"Common Mistakes","text":"<ul> <li>Mixing lookback with start/end.</li> <li>Using too short lookback to detect color change.</li> <li>Expecting run_percentile with insufficient history (use larger <code>--lookback</code>).</li> <li>Using deprecated <code>--interval</code> instead of <code>--period</code>.</li> </ul>"},{"location":"parameters/#multi-timeframe-workflow","title":"Multi-Timeframe Workflow","text":"<p>Weekly context \u2192 Daily execution \u2192 Optional charting.</p>"},{"location":"parameters/#heiken-ashi-run-statistics","title":"Heiken Ashi Run Statistics","text":"<p>The screener derives distribution-aware metrics for trend maturity:</p> Field Description <code>run_length</code> Consecutive same-color HA candles ending at latest bar <code>run_percentile</code> Inclusive percentile rank of <code>run_length</code> among all historical runs in current dataset <p>CLI Filters: - <code>--min-run-percentile PCT</code> include only runs with percentile &gt;= PCT. - <code>--max-run-percentile PCT</code> include only runs with percentile &lt;= PCT.</p> <p>Guidelines: - 90\u2013100: Extended; evaluate for exhaustion. - 60\u201380: Mature; monitor for divergence. - 20\u201340: Emerging; possible continuation potential. - 0\u201310: Fresh or rare short reversal start.</p> <p>Notes: - Percentile uses inclusive ranking (count of runs &lt;= current / total * 100). - Expand <code>--lookback</code> to improve percentile stability. - Combine with <code>--changed-only</code> to isolate fresh flips vs continuations.</p>"},{"location":"quick_reference/","title":"Quick Reference","text":""},{"location":"quick_reference/#core-commands","title":"Core Commands","text":"<pre><code>stockcharts-screen --color green --period 1d\nstockcharts-screen --color red --period 1wk\nstockcharts-screen --min-run-percentile 90 --period 1d          # Extended runs\nstockcharts-screen --max-run-percentile 25 --period 1d          # Early runs\nstockcharts-rsi-divergence --type bullish --min-price 10\nstockcharts-rsi-divergence --type bearish --min-volume 2_000_000\nstockcharts-plot-divergence --ticker NVDA --period 6mo\nstockcharts-beta-regime --regime risk-on --min-volume 1000000   # Risk-on stocks\nstockcharts-beta-regime --regime risk-off                       # Risk-off (contrarian)\npython scripts/sector_regime.py                                 # McGlone sector analysis\npython scripts/sector_regime.py --comprehensive                 # All 90+ ETFs\n</code></pre>"},{"location":"quick_reference/#common-parameter-combos","title":"Common Parameter Combos","text":"Goal Command Bullish divergences mid-price <code>stockcharts-rsi-divergence --type bullish --min-price 10 --max-price 100 --period 6mo</code> Bearish exhaustion high caps <code>stockcharts-rsi-divergence --type bearish --min-price 100 --period 1y</code> Green HA weekly continuation <code>stockcharts-screen --color green --period 1wk</code> Extended HA runs (top decile) <code>stockcharts-screen --min-run-percentile 90 --period 1d</code> Mid-maturity HA runs (40\u201370%) <code>stockcharts-screen --min-run-percentile 40 --max-run-percentile 70 --period 1d</code> Divergences liquid only <code>stockcharts-rsi-divergence --min-volume 5_000_000</code> Intersect HA + RSI <code>stockcharts-rsi-divergence --input-filter results/ha_green.csv --type bullish</code> Risk-off contrarian candidates <code>stockcharts-beta-regime --regime risk-off --min-price 20</code> McGlone sector BUY signals <code>python scripts/sector_regime.py --comprehensive</code> ## Files to Know - <code>divergence.py</code> (RSI divergence logic) - <code>rsi.py</code> (RSI computation) - <code>screener/screener.py</code> (Heiken Ashi logic) - <code>charts/divergence.py</code> (price + RSI chart)"},{"location":"quick_reference/#adjusting-tolerance","title":"Adjusting Tolerance","text":"<p>Edit <code>BEARISH_RSI_TOLERANCE</code> / <code>BULLISH_RSI_TOLERANCE</code> in <code>divergence.py</code>.</p>"},{"location":"quick_reference/#troubleshooting","title":"Troubleshooting","text":"Issue Fix No divergences Increase <code>--lookback</code> or lower <code>--swing-window</code> Too many signals Raise <code>--min-volume</code> or increase tolerance Rate limit errors Increase <code>--delay</code> Missing charts markers Ensure precomputed indices available"},{"location":"quick_reference/#extended-daily-workflow-merged","title":"Extended Daily Workflow (Merged)","text":""},{"location":"quick_reference/#environment-setup","title":"Environment Setup","text":"<pre><code>conda create -n stockcharts python=3.12 -y\nconda activate stockcharts\npip install -r requirements.txt\npip install -e .\n</code></pre>"},{"location":"quick_reference/#morning-scan","title":"Morning Scan","text":"<pre><code>stockcharts-screen --color all --output results/morning_scan.csv\n</code></pre>"},{"location":"quick_reference/#weekly-bullishbearish-sets","title":"Weekly Bullish/Bearish Sets","text":"<pre><code>stockcharts-screen --color green --period 1wk --output results/weekly_bullish.csv\nstockcharts-screen --color red --period 1wk --output results/weekly_bearish.csv\n</code></pre>"},{"location":"quick_reference/#batch-chart-generation-powershell","title":"Batch Chart Generation (PowerShell)","text":"<pre><code>$tickers = @('AAPL','MSFT','GOOGL','NVDA')\nforeach ($t in $tickers) { python scripts\\plot_heiken_ashi.py --ticker $t --output \"charts\\$t.png\" }\n</code></pre>"},{"location":"quick_reference/#programmatic-example","title":"Programmatic Example","text":"<pre><code>from stockcharts.data.fetch import fetch_ohlc\nfrom stockcharts.charts.heiken_ashi import heiken_ashi\nfrom stockcharts.indicators.heiken_runs import compute_ha_run_stats\n\ndf = fetch_ohlc('AAPL', period='1d', lookback='3mo')\nha = heiken_ashi(df)\nstats = compute_ha_run_stats(ha)\nprint(stats['run_length'], stats['run_percentile'])\n</code></pre>"},{"location":"roadmap/","title":"Roadmap &amp; Next Steps","text":""},{"location":"roadmap/#near-term","title":"Near-Term","text":"<ul> <li>Average volume filter (20-day) instead of single-bar volume.</li> <li>Percentage-based RSI divergence tolerance.</li> <li>Chart overlay for Heiken Ashi + divergence combined.</li> </ul>"},{"location":"roadmap/#mid-term","title":"Mid-Term","text":"<ul> <li>Multi-timeframe divergence aggregation (daily + weekly alignment).</li> <li>Configurable ticker universe via external YAML/JSON.</li> <li>Caching layer for faster repeated scans.</li> </ul>"},{"location":"roadmap/#long-term","title":"Long-Term","text":"<ul> <li>Live watchlist regeneration (scheduled task integration).</li> <li>Web dashboard (FastAPI + lightweight frontend) for interactive filtering.</li> <li>Additional indicators (MACD divergence, Stochastics).</li> </ul>"},{"location":"roadmap/#technical-debt","title":"Technical Debt","text":"<ul> <li>Centralize parameter validation across CLI commands.</li> <li>Improve error reporting on failed yfinance fetches.</li> <li>Expand unit tests for divergence edge cases.</li> </ul>"},{"location":"roadmap/#research-ideas","title":"Research Ideas","text":"<ul> <li>Statistical reliability study: Divergence outcome probabilities.</li> <li>Volume divergence vs price/RSI interaction.</li> <li>Multi-factor scoring (price structure + divergence strength + volume trend).</li> </ul>"},{"location":"roadmap/#completed-historical","title":"Completed (Historical)","text":"<ul> <li>Heiken Ashi Screener</li> <li>RSI Divergence Screener</li> <li>Precomputed divergence indices for charts</li> <li>Volume filter parameter</li> <li>RSI tolerance patch to remove false positives</li> <li>Beta Regime Screener (risk-on/risk-off detection)</li> <li>McGlone Contrarian Sector Analysis (90+ ETFs, 3-criteria buy signals)</li> </ul>"},{"location":"rsi_divergence/","title":"RSI Price Divergence Screener","text":""},{"location":"rsi_divergence/#concept-recap","title":"Concept Recap","text":"<p>Divergence highlights momentum disagreement between price action and RSI, hinting at potential reversal or weakening trend. - Bullish: Price lower low, RSI higher low. - Bearish: Price higher high, RSI lower high.</p>"},{"location":"rsi_divergence/#workflow","title":"Workflow","text":"<ol> <li>Fetch OHLC data.</li> <li>Compute RSI (default period=14, EWM-based).</li> <li>Identify swing highs/lows (window default=5).</li> <li>Compare last two valid price + RSI swing pairs.</li> <li>Apply tolerance to avoid noise (&gt;=0.5 RSI point difference required).</li> <li>Output structured results + optional CSV.</li> </ol>"},{"location":"rsi_divergence/#command-line-usage","title":"Command-Line Usage","text":"<pre><code>stockcharts-rsi-divergence                  # all signals\nstockcharts-rsi-divergence --type bullish   # only bullish\nstockcharts-rsi-divergence --type bearish   # only bearish\nstockcharts-rsi-divergence --min-price 10 --max-price 100\nstockcharts-rsi-divergence --rsi-period 21 --lookback 90 --period 6mo\nstockcharts-rsi-divergence --min-volume 2_000_000\n</code></pre> <p>Key options:</p> <pre><code>--type {bullish,bearish,all}\n--min-price N --max-price N\n--min-volume N\n--rsi-period N\n--swing-window N\n--lookback N  (bars for divergence search)\n--period {3mo,6mo,1y}  (data fetch span)\n--output FILE\n--input-filter FILE (restrict tickers to prior screener results)\n</code></pre>"},{"location":"rsi_divergence/#result-object-csv-columns","title":"Result Object (CSV Columns)","text":"<ul> <li>Ticker, Company, Price, RSI, Divergence Type</li> <li>Bullish, Bearish (booleans)</li> <li>Details (string describing swing comparison)</li> <li>Precomputed indices for chart overlay</li> </ul>"},{"location":"rsi_divergence/#tolerance-logic","title":"Tolerance Logic","text":"<pre><code>BEARISH_RSI_TOLERANCE = 0.5\nBULLISH_RSI_TOLERANCE = 0.5\n# Bearish: RSI2 + tol &lt; RSI1\n# Bullish: RSI2 - tol &gt; RSI1\n</code></pre> <p>Prevents false positives (e.g., PLTR slight higher RSI not flagged bearish).</p>"},{"location":"rsi_divergence/#programmatic-use","title":"Programmatic Use","text":"<pre><code>from stockcharts.screener.rsi_divergence import screen_rsi_divergence\nresults = screen_rsi_divergence(divergence_type='bullish', min_price=10.0, period='6mo')\nfor r in results:\n    print(r.ticker, r.divergence_type, r.rsi, r.details)\n</code></pre>"},{"location":"rsi_divergence/#plotting","title":"Plotting","text":"<pre><code>stockcharts-plot-divergence --ticker NVDA --period 6mo --period 1d\n</code></pre> <p>Overlays price + RSI + detected divergence markers (using precomputed indices if provided).</p> <p>Note: <code>stockcharts-plot-divergence</code> now uses <code>--period</code> for aggregation (<code>1d</code>, <code>1wk</code>, <code>1mo</code>) for consistency with other commands. The legacy <code>--interval</code> flag remains as a deprecated alias.</p>"},{"location":"rsi_divergence/#enhancements-implemented","title":"Enhancements Implemented","text":"<ul> <li>Input filtering to intersect signals with HA screener output.</li> <li>Volume filter to restrict to liquid setups.</li> <li>Precomputed divergence indices to guarantee chart marker alignment.</li> <li>RSI tolerance to remove marginal noise.</li> </ul>"},{"location":"rsi_divergence/#future-improvements","title":"Future Improvements","text":"<p>See <code>docs/roadmap.md</code>.</p>"},{"location":"rsi_divergence/#extended-guide-merged","title":"Extended Guide (Merged)","text":"<p>The legacy comprehensive guide has been merged here for single-source documentation. It includes detailed trading workflows, expanded CLI examples, Python API usage, interpretation guidelines, strategy integrations (Heiken Ashi + RSI), and troubleshooting. For full historical content refer to repository history; redundant sections have been consolidated to avoid duplication.</p>"},{"location":"rsi_divergence/#detailed-concepts","title":"Detailed Concepts","text":"<p>Bullish divergence: Price forms lower low while RSI forms higher low (momentum improvement). Bearish divergence: Price forms higher high while RSI forms lower high (momentum deterioration).</p>"},{"location":"rsi_divergence/#expanded-cli-examples","title":"Expanded CLI Examples","text":"<pre><code>stockcharts-rsi-divergence --type bullish --min-price 10 --period 6mo --output results/swing_trades.csv\nstockcharts-rsi-divergence --period 1mo --rsi-period 9\nstockcharts-rsi-divergence --type bearish --min-price 100 --period 1y\nstockcharts-rsi-divergence --rsi-period 21 --lookback 90 --period 1y\n</code></pre>"},{"location":"rsi_divergence/#python-usage-pattern","title":"Python Usage Pattern","text":"<pre><code>from stockcharts.screener.rsi_divergence import screen_rsi_divergence, save_results_to_csv\nresults = screen_rsi_divergence(divergence_type='bullish', min_price=10.0, period='6mo')\nfor r in results:\n    print(r.ticker, r.close_price, r.rsi, r.divergence_type, r.details)\nsave_results_to_csv(results, 'bullish_divergences.csv')\n</code></pre>"},{"location":"rsi_divergence/#csv-output-columns","title":"CSV Output Columns","text":"<p>Ticker, Company, Price, RSI, Divergence Type, Bullish, Bearish, Details.</p>"},{"location":"rsi_divergence/#strategy-intersection-rsi-heiken-ashi","title":"Strategy Intersection (RSI + Heiken Ashi)","text":"<p>Use divergence screener first, then feed tickers to HA color change screener via <code>--input-filter</code> for higher confidence setups.</p>"},{"location":"rsi_divergence/#troubleshooting-tips","title":"Troubleshooting Tips","text":"<ul> <li>No results: increase <code>--lookback</code>, decrease <code>--swing-window</code>.</li> <li>Too many results: raise <code>--min-volume</code>, tighten price filters.</li> <li>Slow performance: restrict universe with price/volume filters or custom ticker list.</li> </ul>"},{"location":"rsi_divergence/#best-practices","title":"Best Practices","text":"<p>Confirm divergence with price action (reversal candle patterns), volume expansion, and multi-timeframe alignment. Apply disciplined risk management (stops below swing lows for bullish, above swing highs for bearish).</p>"},{"location":"screener/","title":"Heiken Ashi Screener","text":""},{"location":"screener/#purpose","title":"Purpose","text":"<p>Identify immediate bullish (green) or bearish (red) Heiken Ashi candle conditions across a curated NASDAQ list.</p>"},{"location":"screener/#core-concept","title":"Core Concept","text":"<p>A Heiken Ashi candle is green when <code>HA_Close &gt;= HA_Open</code> and red otherwise. Latest candle color offers a bias snapshot.</p>"},{"location":"screener/#run-statistics","title":"Run Statistics","text":"<p>Each contiguous sequence of same-color candles forms a \"run\". The screener now reports: - <code>run_length</code>: Count of consecutive candles of the current color ending at the latest bar. - <code>run_percentile</code>: Inclusive percentile rank (0\u2013100) of <code>run_length</code> within all historical run lengths over the fetched lookback + period aggregation.</p> <p>Interpretation: - High percentile (e.g. 90+): Extended move; watch for exhaustion or reversal catalysts. - Low percentile (e.g. &lt;25): Early/immature move; potential continuation room. - Combine with <code>--changed-only</code> to isolate fresh color flips versus mature trends.</p>"},{"location":"screener/#command-line-usage","title":"Command-Line Usage","text":"<pre><code>stockcharts-screen --color green --period 1d\nstockcharts-screen --color red --period 1wk\nstockcharts-screen --color all --period 1d --output results/all.csv\nstockcharts-screen --color green --period 1d --limit 20 --delay 0.2\n\n# Extended run scan (top decile)\nstockcharts-screen --min-run-percentile 90 --period 1d\n\n# Short/early run scan (bottom quartile)\nstockcharts-screen --max-run-percentile 25 --period 1d\n\n# Range filter (mid-maturity 40\u201370%)\nstockcharts-screen --min-run-percentile 40 --max-run-percentile 70 --period 1d\n</code></pre> <p>Options:</p> <pre><code>--color {green,red,all}\n--period {1d,1wk,1mo}\n--limit N\n--delay SECONDS\n--output FILE\n--quiet\n--min-run-percentile PCT   (include runs &gt;= PCT)\n--max-run-percentile PCT   (include runs &lt;= PCT)\n--changed-only             (only tickers whose color flipped on last bar)\n</code></pre>"},{"location":"screener/#programmatic-usage","title":"Programmatic Usage","text":"<pre><code>from stockcharts.screener.screener import screen_nasdaq\nresults = screen_nasdaq(color_filter=\"green\", period=\"1d\", delay=0.5)\nfor r in results:\n    print(r.ticker, r.color, r.run_length, r.run_percentile)\n</code></pre> <p>Dataclass (simplified):</p> <pre><code>@dataclass\nclass ScreenResult:\n    ticker: str\n    color: Literal['green','red']\n    ha_open: float\n    ha_close: float\n    last_date: str\n    period: str\n    run_length: int\n    run_percentile: float  # 0.0\u2013100.0\n</code></pre>"},{"location":"screener/#ticker-universe","title":"Ticker Universe","text":"<p>Located in <code>src/stockcharts/screener/nasdaq.py</code> (90+ high-liquidity NASDAQ names). Extend by editing the list.</p>"},{"location":"screener/#performance","title":"Performance","text":"<ul> <li>~1\u20132 minutes for full list with default 0.5s delay.</li> <li>Reduce delay at risk of API throttling.</li> <li>Use <code>--limit</code> for development/testing.</li> </ul>"},{"location":"screener/#how-it-works","title":"How It Works","text":"<ol> <li>Download OHLC data via yfinance.</li> <li>Compute Heiken Ashi candles.</li> <li>Determine last candle color.</li> <li>Filter &amp; aggregate results.</li> <li>Optionally output CSV.</li> </ol>"},{"location":"screener/#integration-points","title":"Integration Points","text":"<ul> <li>Shares data retrieval logic with RSI divergence screener.</li> <li>Charts can visualize individual tickers with HA candles (using <code>charts/heiken_ashi.py</code>).</li> </ul>"},{"location":"screener/#example-output","title":"Example Output","text":"<pre><code>Ticker  Color  HA_Open  HA_Close  Last Date   Period  Run Length  Run Percentile\nAVGO    green  338.72   353.09    2025-10-13  1d      6           92.3\nAAPL    red    253.25   248.07    2025-10-13  1d      2           28.6\n</code></pre>"},{"location":"screener/#trading-style-guidance","title":"Trading Style Guidance","text":"<ul> <li>Bullish daily green: potential continuation.</li> <li>Weekly red emerging: possible broader weakness.</li> <li>High run percentile + divergence: watch for reversal setups.</li> <li>Low run percentile after color flip: monitor for early momentum follow-through.</li> <li>Combine with RSI divergence for confirmation.</li> </ul> <p>See <code>docs/trading_styles.md</code> for deeper strategy notes.</p>"},{"location":"trading_styles/","title":"Trading Style Guidance","text":""},{"location":"trading_styles/#swing-trading","title":"Swing Trading","text":"<p>Focus on daily bullish divergences confirmed by green HA candles. Parameters:</p> <pre><code>stockcharts-screen --color green --period 1d --output results/ha_green.csv\nstockcharts-rsi-divergence --type bullish --input-filter results/ha_green.csv --min-price 10 --period 6mo\n</code></pre> <p>Combine with volume filter for higher quality: <code>--min-volume 2_000_000</code>.</p>"},{"location":"trading_styles/#trend-continuation","title":"Trend Continuation","text":"<p>Weekly green HA + absence of bearish divergence can indicate sustained momentum. Monitor RSI staying above 50.</p>"},{"location":"trading_styles/#exhaustion-reversal-short","title":"Exhaustion / Reversal Short","text":"<p>Bearish divergence + red HA candle on daily/weekly near prior resistance:</p> <pre><code>stockcharts-rsi-divergence --type bearish --min-price 50 --min-volume 2_000_000\n</code></pre>"},{"location":"trading_styles/#high-liquidity-focus","title":"High Liquidity Focus","text":"<p>Use both price and volume constraints:</p> <pre><code>--min-price 20 --min-volume 5_000_000\n</code></pre> <p>Filters out thin and erratic names.</p>"},{"location":"trading_styles/#conservative-filtering","title":"Conservative Filtering","text":"<p>Increase swing window (7) and RSI period (21) for smoother signals.</p>"},{"location":"trading_styles/#aggressive-scouting","title":"Aggressive Scouting","text":"<p>Lower RSI period (9) and swing window (3) for early/premature signals (expect more noise). Use for watchlist generation.</p>"},{"location":"trading_styles/#multi-factor-intersection","title":"Multi-Factor Intersection","text":"<p>Workflow: 1. Run HA screener (green). 2. Feed tickers into divergence screener (<code>--input-filter</code>). 3. Plot top setups for manual validation.</p>"},{"location":"trading_styles/#manual-validation-checklist","title":"Manual Validation Checklist","text":"<ul> <li>Divergence distance (RSI difference &gt; 0.5 confirmed)</li> <li>Price context (support/resistance proximity)</li> <li>Volume trend (expansion on reversal attempt?)</li> <li>Broader market alignment (index direction)</li> </ul>"},{"location":"trading_styles/#risk-management-notes","title":"Risk Management Notes","text":"<ul> <li>Divergence \u2260 guaranteed reversal.</li> <li>Use stop below swing low (bullish) / above swing high (bearish).</li> <li>Position size adjusts for volatility (ATR or percentage basis).</li> </ul>"},{"location":"trading_styles/#extended-time-window-reference-merged","title":"Extended Time Window Reference (Merged)","text":"<p>The detailed time window and style guide has been merged here for clarity.</p>"},{"location":"trading_styles/#aggregation-period-period","title":"Aggregation Period (<code>--period</code>)","text":"<p>Defines candle size / bar interval: <code>1m</code>, <code>5m</code>, <code>15m</code>, <code>1h</code>, <code>1d</code>, <code>1wk</code>, <code>1mo</code>.</p>"},{"location":"trading_styles/#lookback-window-lookback","title":"Lookback Window (<code>--lookback</code>)","text":"<p>Historical data span fetched: <code>5d</code>, <code>1mo</code>, <code>3mo</code>, <code>6mo</code>, <code>1y</code>, <code>2y</code>, <code>5y</code>, <code>ytd</code>, <code>max</code>.</p>"},{"location":"trading_styles/#custom-date-range-start-end","title":"Custom Date Range (<code>--start</code> / <code>--end</code>)","text":"<p>Use explicit date range for historical backtests; overrides lookback when both provided.</p>"},{"location":"trading_styles/#style-examples","title":"Style Examples","text":"<p>Day Trading (short context):</p> <pre><code>stockcharts-screen --color green --changed-only --period 1h --lookback 5d --limit 100\n</code></pre> <p>Swing Trading (recommended):</p> <pre><code>stockcharts-screen --color green --changed-only --period 1d --lookback 3mo\n</code></pre> <p>Position Trading (long trend):</p> <pre><code>stockcharts-screen --color green --changed-only --period 1wk --lookback 5y\n</code></pre>"},{"location":"trading_styles/#multi-timeframe-workflow","title":"Multi-Timeframe Workflow","text":"<ol> <li>Weekly trend scan \u2192 <code>--lookback 1y --period 1wk</code></li> <li>Daily timing scan \u2192 <code>--lookback 3mo --period 1d</code></li> <li>Intersect results and plot charts.</li> </ol>"},{"location":"trading_styles/#common-validity-rules","title":"Common Validity Rules","text":"<ul> <li>Cannot combine <code>--lookback</code> with <code>--start/--end</code>.</li> <li>Default lookback of 1y used if none specified.</li> </ul>"},{"location":"trading_styles/#backtest-example","title":"Backtest Example","text":"<pre><code>stockcharts-screen --color green --changed-only --start 2024-01-01 --end 2024-03-31 --limit 500\n</code></pre>"},{"location":"trading_styles/#output-archival","title":"Output Archival","text":"<p>Name output files with parameters for reproducibility (e.g., <code>swing_reversals_3mo.csv</code>).</p>"},{"location":"volume/","title":"Volume Filtering","text":""},{"location":"volume/#motivation","title":"Motivation","text":"<p>Divergence signals on illiquid tickers are prone to false triggers due to erratic prints. Volume filtering restricts results to symbols with sufficient trading interest.</p>"},{"location":"volume/#parameter","title":"Parameter","text":"<pre><code>--min-volume N\n</code></pre> <p>Applied to the most recent bar's volume (or optionally average in future enhancement).</p>"},{"location":"volume/#usage-examples","title":"Usage Examples","text":"<pre><code>stockcharts-rsi-divergence --min-volume 2_000_000\nstockcharts-rsi-divergence --type bullish --min-volume 5_000_000 --min-price 10\n</code></pre>"},{"location":"volume/#impact","title":"Impact","text":"<ul> <li>Reduces total divergence count.</li> <li>Increases average reliability of remaining setups.</li> <li>Helps align with institutional-grade liquidity.</li> </ul>"},{"location":"volume/#suggested-thresholds","title":"Suggested Thresholds","text":"<ul> <li>1,000,000: Light filter</li> <li>2,000,000: Moderate baseline</li> <li>5,000,000: High liquidity focus</li> </ul>"},{"location":"volume/#extended-guide-merged","title":"Extended Guide (Merged)","text":""},{"location":"volume/#why-volume-matters","title":"Why Volume Matters","text":"<p>Low volume \u2192 wider spreads, manipulation risk; high volume \u2192 tighter spreads, reliable price action.</p>"},{"location":"volume/#recommended-thresholds-by-style","title":"Recommended Thresholds By Style","text":"<p>Day: \u22651,000,000; Swing: \u2265500,000; Position: \u2265300,000.</p>"},{"location":"volume/#progressive-filtering-workflow","title":"Progressive Filtering Workflow","text":"<pre><code>stockcharts-screen --color green --changed-only --min-volume 500000 --output green_500k.csv\nstockcharts-screen --color green --changed-only --min-volume 1000000 --output green_1m.csv\nstockcharts-screen --color green --changed-only --min-volume 5000000 --output green_5m.csv\n</code></pre>"},{"location":"volume/#combined-daily-weekly-confirmation","title":"Combined Daily + Weekly Confirmation","text":"<p>Use same volume threshold across intervals to reinforce liquidity consistency.</p>"},{"location":"volume/#volume-calculation","title":"Volume Calculation","text":"<p>Current implementation uses last bar volume; future enhancement: rolling average (20-bar) or relative volume.</p>"},{"location":"volume/#quick-reference-threshold-categories","title":"Quick Reference Threshold Categories","text":"<p>&lt;100K Avoid; 300K\u2013500K Moderate; 500K\u20131M Good; 1M\u20135M High; &gt;5M Very High.</p>"},{"location":"volume/#future-extensions","title":"Future Extensions","text":"<ul> <li>Average volume (20-day) filtering.</li> <li>Relative volume measures (current / average).</li> <li>Combined price*volume market cap proxy.</li> </ul>"},{"location":"api/","title":"API Reference","text":"<p>This section provides detailed API documentation for the StockCharts package, automatically generated from source code docstrings.</p>"},{"location":"api/#core-modules","title":"Core Modules","text":"<ul> <li>Divergence Detection - RSI/Price divergence detection algorithms</li> <li>Pivot Detection - Swing point and EMA-derivative pivot identification</li> <li>RSI Indicator - Relative Strength Index calculation</li> <li>Beta &amp; Relative Strength - Rolling beta and market regime detection</li> <li>Screener - Heiken Ashi stock screening and filtering logic</li> <li>Beta Regime Screener - Risk-on/risk-off regime screening</li> <li>Data Fetching - Market data retrieval and caching</li> <li>Heiken Ashi Runs - Run length and percentile statistics for trend maturity</li> </ul>"},{"location":"api/#usage","title":"Usage","text":"<p>Import functions directly from their modules:</p> <pre><code>from stockcharts.indicators.divergence import detect_divergence\nfrom stockcharts.indicators.rsi import compute_rsi\nfrom stockcharts.indicators.pivots import ema_derivative_pivots\nfrom stockcharts.indicators.beta import compute_rolling_beta, analyze_beta_regime\nfrom stockcharts.screener.rsi_divergence import screen_rsi_divergence\nfrom stockcharts.screener.beta_regime import screen_beta_regime\n</code></pre> <p>For complete usage examples, see the Quick Reference, RSI Divergence Guide, and Beta Regime Guide.</p>"},{"location":"api/beta/","title":"Beta &amp; Relative Strength Indicators","text":"<p>This module provides beta calculation and market regime detection based on relative strength analysis.</p>"},{"location":"api/beta/#core-functions","title":"Core Functions","text":""},{"location":"api/beta/#stockcharts.indicators.beta","title":"<code>beta</code>","text":"<p>Beta and relative strength regime analysis module.</p> <p>Implements Mike McGlone's approach to regime detection: - Relative strength ratio (asset/benchmark) vs its moving average - Rolling beta calculation using covariance/variance - Regime signal: \"risk-on\" when ratio above MA, \"risk-off\" when below</p> Public API <p>compute_rolling_beta(asset_returns, benchmark_returns, window=60) -&gt; pd.Series compute_relative_strength(asset_close, benchmark_close) -&gt; pd.Series compute_regime_signal(ratio, ma_period=200) -&gt; dict analyze_beta_regime(asset_df, benchmark_df, ma_period=200, beta_window=60) -&gt; dict</p>"},{"location":"api/beta/#stockcharts.indicators.beta.compute_rolling_beta","title":"<code>compute_rolling_beta(asset_returns, benchmark_returns, window=60)</code>","text":"<p>Compute rolling beta of asset relative to benchmark.</p> <p>Beta = Cov(asset_returns, benchmark_returns) / Var(benchmark_returns)</p> <p>Parameters:</p> Name Type Description Default <code>asset_returns</code> <code>Series</code> <p>Series of asset percentage returns.</p> required <code>benchmark_returns</code> <code>Series</code> <p>Series of benchmark percentage returns.</p> required <code>window</code> <code>int</code> <p>Rolling window size for beta calculation (default: 60 periods).</p> <code>60</code> <p>Returns:</p> Type Description <code>Series</code> <p>Series of rolling beta values. NaN where insufficient history.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If window &lt; 2.</p> Source code in <code>src/stockcharts/indicators/beta.py</code> <pre><code>def compute_rolling_beta(\n    asset_returns: pd.Series,\n    benchmark_returns: pd.Series,\n    window: int = 60,\n) -&gt; pd.Series:\n    \"\"\"Compute rolling beta of asset relative to benchmark.\n\n    Beta = Cov(asset_returns, benchmark_returns) / Var(benchmark_returns)\n\n    Args:\n        asset_returns: Series of asset percentage returns.\n        benchmark_returns: Series of benchmark percentage returns.\n        window: Rolling window size for beta calculation (default: 60 periods).\n\n    Returns:\n        Series of rolling beta values. NaN where insufficient history.\n\n    Raises:\n        ValueError: If window &lt; 2.\n    \"\"\"\n    if window &lt; 2:\n        raise ValueError(\"window must be &gt;= 2\")\n\n    # Align the series by index\n    aligned = pd.DataFrame(\n        {\n            \"asset\": asset_returns,\n            \"benchmark\": benchmark_returns,\n        }\n    ).dropna()\n\n    if len(aligned) &lt; window:\n        return pd.Series([float(\"nan\")] * len(asset_returns), index=asset_returns.index)\n\n    # Rolling covariance and variance\n    rolling_cov = aligned[\"asset\"].rolling(window=window).cov(aligned[\"benchmark\"])\n    rolling_var = aligned[\"benchmark\"].rolling(window=window).var()\n\n    # Beta = Cov / Var\n    beta = rolling_cov / rolling_var\n\n    # Reindex to original asset index\n    return beta.reindex(asset_returns.index)\n</code></pre>"},{"location":"api/beta/#stockcharts.indicators.beta.compute_relative_strength","title":"<code>compute_relative_strength(asset_close, benchmark_close)</code>","text":"<p>Compute relative strength ratio of asset vs benchmark.</p> <p>Relative Strength = Asset Price / Benchmark Price</p> <p>This ratio shows whether the asset is outperforming (rising ratio) or underperforming (falling ratio) the benchmark.</p> <p>Parameters:</p> Name Type Description Default <code>asset_close</code> <code>Series</code> <p>Series of asset closing prices.</p> required <code>benchmark_close</code> <code>Series</code> <p>Series of benchmark closing prices.</p> required <p>Returns:</p> Type Description <code>Series</code> <p>Series of relative strength ratios.</p> Source code in <code>src/stockcharts/indicators/beta.py</code> <pre><code>def compute_relative_strength(\n    asset_close: pd.Series,\n    benchmark_close: pd.Series,\n) -&gt; pd.Series:\n    \"\"\"Compute relative strength ratio of asset vs benchmark.\n\n    Relative Strength = Asset Price / Benchmark Price\n\n    This ratio shows whether the asset is outperforming (rising ratio)\n    or underperforming (falling ratio) the benchmark.\n\n    Args:\n        asset_close: Series of asset closing prices.\n        benchmark_close: Series of benchmark closing prices.\n\n    Returns:\n        Series of relative strength ratios.\n    \"\"\"\n    # Align by index\n    aligned = pd.DataFrame(\n        {\n            \"asset\": asset_close,\n            \"benchmark\": benchmark_close,\n        }\n    ).dropna()\n\n    if aligned.empty:\n        return pd.Series(dtype=float)\n\n    ratio = aligned[\"asset\"] / aligned[\"benchmark\"]\n    return ratio\n</code></pre>"},{"location":"api/beta/#stockcharts.indicators.beta.compute_regime_signal","title":"<code>compute_regime_signal(ratio, ma_period=200)</code>","text":"<p>Determine regime signal based on ratio vs its moving average.</p> <p>Parameters:</p> Name Type Description Default <code>ratio</code> <code>Series</code> <p>Series of relative strength ratios.</p> required <code>ma_period</code> <code>int</code> <p>Moving average period for regime detection (default: 200).</p> <code>200</code> <p>Returns:</p> Type Description <code>dict</code> <p>dict with keys: - 'ratio': current ratio value - 'ma': current moving average value - 'regime': \"risk-on\" if ratio &gt; ma, \"risk-off\" if ratio &lt;= ma - 'pct_from_ma': percentage distance from MA - 'ratio_series': full ratio series - 'ma_series': full MA series</p> Source code in <code>src/stockcharts/indicators/beta.py</code> <pre><code>def compute_regime_signal(\n    ratio: pd.Series,\n    ma_period: int = 200,\n) -&gt; dict:\n    \"\"\"Determine regime signal based on ratio vs its moving average.\n\n    Args:\n        ratio: Series of relative strength ratios.\n        ma_period: Moving average period for regime detection (default: 200).\n\n    Returns:\n        dict with keys:\n            - 'ratio': current ratio value\n            - 'ma': current moving average value\n            - 'regime': \"risk-on\" if ratio &gt; ma, \"risk-off\" if ratio &lt;= ma\n            - 'pct_from_ma': percentage distance from MA\n            - 'ratio_series': full ratio series\n            - 'ma_series': full MA series\n    \"\"\"\n    if len(ratio) &lt; ma_period:\n        return {\n            \"ratio\": float(\"nan\"),\n            \"ma\": float(\"nan\"),\n            \"regime\": \"insufficient-data\",\n            \"pct_from_ma\": float(\"nan\"),\n            \"ratio_series\": ratio,\n            \"ma_series\": pd.Series(dtype=float),\n        }\n\n    ma_series = ratio.rolling(window=ma_period).mean()\n\n    current_ratio = ratio.iloc[-1]\n    current_ma = ma_series.iloc[-1]\n\n    if pd.isna(current_ratio) or pd.isna(current_ma):\n        regime = \"insufficient-data\"\n        pct_from_ma = float(\"nan\")\n    else:\n        regime = \"risk-on\" if current_ratio &gt; current_ma else \"risk-off\"\n        pct_from_ma = ((current_ratio - current_ma) / current_ma) * 100\n\n    return {\n        \"ratio\": current_ratio,\n        \"ma\": current_ma,\n        \"regime\": regime,\n        \"pct_from_ma\": pct_from_ma,\n        \"ratio_series\": ratio,\n        \"ma_series\": ma_series,\n    }\n</code></pre>"},{"location":"api/beta/#stockcharts.indicators.beta.analyze_beta_regime","title":"<code>analyze_beta_regime(asset_df, benchmark_df, ma_period=200, beta_window=60)</code>","text":"<p>Complete beta regime analysis for an asset vs benchmark.</p> <p>Combines relative strength ratio, regime signal, and rolling beta.</p> <p>Parameters:</p> Name Type Description Default <code>asset_df</code> <code>DataFrame</code> <p>DataFrame with 'Close' column for the asset.</p> required <code>benchmark_df</code> <code>DataFrame</code> <p>DataFrame with 'Close' column for the benchmark.</p> required <code>ma_period</code> <code>int</code> <p>Moving average period for regime detection (default: 200).</p> <code>200</code> <code>beta_window</code> <code>int</code> <p>Rolling window for beta calculation (default: 60).</p> <code>60</code> <p>Returns:</p> Type Description <code>dict</code> <p>dict with keys: - 'relative_strength': current RS ratio - 'rs_ma': RS moving average value - 'regime': \"risk-on\" or \"risk-off\" - 'pct_from_ma': percentage distance from MA - 'rolling_beta': current rolling beta value - 'asset_price': current asset price - 'benchmark_price': current benchmark price - 'rs_series': full RS ratio series - 'rs_ma_series': full RS MA series - 'beta_series': full rolling beta series</p> Source code in <code>src/stockcharts/indicators/beta.py</code> <pre><code>def analyze_beta_regime(\n    asset_df: pd.DataFrame,\n    benchmark_df: pd.DataFrame,\n    ma_period: int = 200,\n    beta_window: int = 60,\n) -&gt; dict:\n    \"\"\"Complete beta regime analysis for an asset vs benchmark.\n\n    Combines relative strength ratio, regime signal, and rolling beta.\n\n    Args:\n        asset_df: DataFrame with 'Close' column for the asset.\n        benchmark_df: DataFrame with 'Close' column for the benchmark.\n        ma_period: Moving average period for regime detection (default: 200).\n        beta_window: Rolling window for beta calculation (default: 60).\n\n    Returns:\n        dict with keys:\n            - 'relative_strength': current RS ratio\n            - 'rs_ma': RS moving average value\n            - 'regime': \"risk-on\" or \"risk-off\"\n            - 'pct_from_ma': percentage distance from MA\n            - 'rolling_beta': current rolling beta value\n            - 'asset_price': current asset price\n            - 'benchmark_price': current benchmark price\n            - 'rs_series': full RS ratio series\n            - 'rs_ma_series': full RS MA series\n            - 'beta_series': full rolling beta series\n    \"\"\"\n    # Extract close prices\n    asset_close = asset_df[\"Close\"]\n    benchmark_close = benchmark_df[\"Close\"]\n\n    # Compute relative strength\n    rs_ratio = compute_relative_strength(asset_close, benchmark_close)\n\n    # Compute regime signal\n    regime_result = compute_regime_signal(rs_ratio, ma_period=ma_period)\n\n    # Compute returns for beta calculation\n    asset_returns = asset_close.pct_change()\n    benchmark_returns = benchmark_close.pct_change()\n\n    # Compute rolling beta\n    beta_series = compute_rolling_beta(asset_returns, benchmark_returns, window=beta_window)\n    current_beta = beta_series.iloc[-1] if len(beta_series) &gt; 0 else float(\"nan\")\n\n    return {\n        \"relative_strength\": regime_result[\"ratio\"],\n        \"rs_ma\": regime_result[\"ma\"],\n        \"regime\": regime_result[\"regime\"],\n        \"pct_from_ma\": regime_result[\"pct_from_ma\"],\n        \"rolling_beta\": current_beta,\n        \"asset_price\": asset_close.iloc[-1] if len(asset_close) &gt; 0 else float(\"nan\"),\n        \"benchmark_price\": benchmark_close.iloc[-1] if len(benchmark_close) &gt; 0 else float(\"nan\"),\n        \"rs_series\": regime_result[\"ratio_series\"],\n        \"rs_ma_series\": regime_result[\"ma_series\"],\n        \"beta_series\": beta_series,\n    }\n</code></pre>"},{"location":"api/beta_regime/","title":"Beta Regime Screener","text":"<p>Screen NASDAQ stocks for market regime based on relative strength analysis.</p>"},{"location":"api/beta_regime/#screener-functions","title":"Screener Functions","text":""},{"location":"api/beta_regime/#stockcharts.screener.beta_regime","title":"<code>beta_regime</code>","text":"<p>Beta regime screener for NASDAQ stocks.</p> <p>Screens stocks for risk-on/risk-off regime based on Mike McGlone's methodology: - Relative strength ratio vs benchmark (e.g., SPY) - Ratio compared to its 200-day (or 40-week) moving average - Above MA = risk-on, Below MA = risk-off</p>"},{"location":"api/beta_regime/#stockcharts.screener.beta_regime.BetaRegimeResult","title":"<code>BetaRegimeResult</code>  <code>dataclass</code>","text":"<p>Result from beta regime screening.</p> <p>Attributes:</p> Name Type Description <code>ticker</code> <code>str</code> <p>Stock symbol.</p> <code>company_name</code> <code>str</code> <p>Full company name or ticker if unavailable.</p> <code>benchmark</code> <code>str</code> <p>Benchmark ticker used for comparison.</p> <code>regime</code> <code>Literal['risk-on', 'risk-off', 'insufficient-data']</code> <p>Current regime status (\"risk-on\", \"risk-off\", or \"insufficient-data\").</p> <code>relative_strength</code> <code>float</code> <p>Asset price / benchmark price ratio.</p> <code>ma_value</code> <code>float</code> <p>Moving average of relative strength ratio.</p> <code>pct_from_ma</code> <code>float</code> <p>Percentage distance from moving average.</p> <code>beta</code> <code>float</code> <p>Rolling beta coefficient vs benchmark.</p> <code>close_price</code> <code>float</code> <p>Current asset closing price.</p> <code>benchmark_price</code> <code>float</code> <p>Current benchmark closing price.</p> <code>interval</code> <code>str</code> <p>Candle interval used (\"1d\", \"1wk\", \"1mo\").</p> <code>ma_period</code> <code>int</code> <p>Moving average period used for regime detection.</p> Source code in <code>src/stockcharts/screener/beta_regime.py</code> <pre><code>@dataclass\nclass BetaRegimeResult:\n    \"\"\"Result from beta regime screening.\n\n    Attributes:\n        ticker: Stock symbol.\n        company_name: Full company name or ticker if unavailable.\n        benchmark: Benchmark ticker used for comparison.\n        regime: Current regime status (\"risk-on\", \"risk-off\", or \"insufficient-data\").\n        relative_strength: Asset price / benchmark price ratio.\n        ma_value: Moving average of relative strength ratio.\n        pct_from_ma: Percentage distance from moving average.\n        beta: Rolling beta coefficient vs benchmark.\n        close_price: Current asset closing price.\n        benchmark_price: Current benchmark closing price.\n        interval: Candle interval used (\"1d\", \"1wk\", \"1mo\").\n        ma_period: Moving average period used for regime detection.\n    \"\"\"\n\n    ticker: str\n    company_name: str\n    benchmark: str\n    regime: Literal[\"risk-on\", \"risk-off\", \"insufficient-data\"]\n    relative_strength: float\n    ma_value: float\n    pct_from_ma: float\n    beta: float\n    close_price: float\n    benchmark_price: float\n    interval: str\n    ma_period: int\n</code></pre>"},{"location":"api/beta_regime/#stockcharts.screener.beta_regime.screen_beta_regime","title":"<code>screen_beta_regime(tickers=None, benchmark='SPY', interval='1d', ma_period=200, beta_window=60, regime_filter='all', min_price=None, max_price=None, min_volume=None, lookback=None, start=None, end=None, batch_size=50, verbose=True)</code>","text":"<p>Screen stocks for beta regime status.</p> <p>Parameters:</p> Name Type Description Default <code>tickers</code> <code>list[str] | None</code> <p>List of ticker symbols (if None, uses all NASDAQ).</p> <code>None</code> <code>benchmark</code> <code>str</code> <p>Benchmark ticker for comparison (default: \"SPY\"). Can be any valid yfinance ticker (SPY, QQQ, BTC-USD, etc.).</p> <code>'SPY'</code> <code>interval</code> <code>str</code> <p>Candle interval - \"1d\", \"1wk\", \"1mo\" (default: \"1d\").</p> <code>'1d'</code> <code>ma_period</code> <code>int</code> <p>Moving average period for regime detection. Default: 200 for daily, auto-adjusts to 40 for weekly if 200 is passed.</p> <code>200</code> <code>beta_window</code> <code>int</code> <p>Rolling window for beta calculation (default: 60).</p> <code>60</code> <code>regime_filter</code> <code>Literal['risk-on', 'risk-off', 'all']</code> <p>Filter results by regime - \"risk-on\", \"risk-off\", or \"all\".</p> <code>'all'</code> <code>min_price</code> <code>float | None</code> <p>Minimum stock price filter.</p> <code>None</code> <code>max_price</code> <code>float | None</code> <p>Maximum stock price filter.</p> <code>None</code> <code>min_volume</code> <code>float | None</code> <p>Minimum average daily volume filter.</p> <code>None</code> <code>lookback</code> <code>str | None</code> <p>Historical period (e.g., \"1y\", \"2y\", \"5y\"). Should be longer than ma_period to ensure sufficient data.</p> <code>None</code> <code>start</code> <code>str | None</code> <p>Start date YYYY-MM-DD (overrides lookback if end also provided).</p> <code>None</code> <code>end</code> <code>str | None</code> <p>End date YYYY-MM-DD.</p> <code>None</code> <code>batch_size</code> <code>int | None</code> <p>Tickers per batch for parallel download (default: 50). Set to None for sequential mode.</p> <code>50</code> <code>verbose</code> <code>bool</code> <p>Print progress messages (default: True).</p> <code>True</code> <p>Returns:</p> Type Description <code>list[BetaRegimeResult]</code> <p>List of BetaRegimeResult objects.</p> Source code in <code>src/stockcharts/screener/beta_regime.py</code> <pre><code>def screen_beta_regime(\n    tickers: list[str] | None = None,\n    benchmark: str = \"SPY\",\n    interval: str = \"1d\",\n    ma_period: int = 200,\n    beta_window: int = 60,\n    regime_filter: Literal[\"risk-on\", \"risk-off\", \"all\"] = \"all\",\n    min_price: float | None = None,\n    max_price: float | None = None,\n    min_volume: float | None = None,\n    lookback: str | None = None,\n    start: str | None = None,\n    end: str | None = None,\n    batch_size: int | None = 50,\n    verbose: bool = True,\n) -&gt; list[BetaRegimeResult]:\n    \"\"\"Screen stocks for beta regime status.\n\n    Args:\n        tickers: List of ticker symbols (if None, uses all NASDAQ).\n        benchmark: Benchmark ticker for comparison (default: \"SPY\").\n            Can be any valid yfinance ticker (SPY, QQQ, BTC-USD, etc.).\n        interval: Candle interval - \"1d\", \"1wk\", \"1mo\" (default: \"1d\").\n        ma_period: Moving average period for regime detection.\n            Default: 200 for daily, auto-adjusts to 40 for weekly if 200 is passed.\n        beta_window: Rolling window for beta calculation (default: 60).\n        regime_filter: Filter results by regime - \"risk-on\", \"risk-off\", or \"all\".\n        min_price: Minimum stock price filter.\n        max_price: Maximum stock price filter.\n        min_volume: Minimum average daily volume filter.\n        lookback: Historical period (e.g., \"1y\", \"2y\", \"5y\"). Should be longer\n            than ma_period to ensure sufficient data.\n        start: Start date YYYY-MM-DD (overrides lookback if end also provided).\n        end: End date YYYY-MM-DD.\n        batch_size: Tickers per batch for parallel download (default: 50).\n            Set to None for sequential mode.\n        verbose: Print progress messages (default: True).\n\n    Returns:\n        List of BetaRegimeResult objects.\n    \"\"\"\n    # Auto-adjust MA period for weekly interval\n    effective_ma_period = ma_period\n    if interval == \"1wk\" and ma_period == 200:\n        effective_ma_period = 40  # 40 weeks \u2248 200 days\n        if verbose:\n            print(f\"Auto-adjusted MA period to {effective_ma_period} for weekly interval\")\n\n    # Auto-set lookback if not specified\n    if lookback is None and start is None:\n        # Need enough history for MA calculation + buffer\n        if interval == \"1d\":\n            lookback = \"2y\" if effective_ma_period &lt;= 200 else \"5y\"\n        elif interval == \"1wk\":\n            lookback = \"3y\" if effective_ma_period &lt;= 52 else \"5y\"\n        else:\n            lookback = \"5y\"\n\n    # Get ticker list\n    if tickers is None:\n        if verbose:\n            print(\"Fetching NASDAQ ticker list...\")\n        tickers = get_nasdaq_tickers()\n        if verbose:\n            print(f\"Found {len(tickers)} tickers to screen\")\n\n    # Fetch benchmark data first\n    if verbose:\n        print(f\"Fetching benchmark data ({benchmark})...\")\n\n    try:\n        benchmark_df = fetch_ohlc(\n            benchmark,\n            interval=interval,\n            lookback=lookback if not (start and end) else None,\n            start=start,\n            end=end,\n        )\n    except Exception as e:\n        if verbose:\n            print(f\"Error fetching benchmark {benchmark}: {e}\")\n        return []\n\n    if benchmark_df is None or benchmark_df.empty:\n        if verbose:\n            print(f\"No data for benchmark {benchmark}\")\n        return []\n\n    # Validate sufficient bars for MA calculation\n    bars_available = len(benchmark_df)\n    min_recommended = int(effective_ma_period * 1.5)  # 50% buffer for meaningful trend\n    if bars_available &lt; effective_ma_period:\n        if verbose:\n            print(\n                f\"\u26a0\ufe0f  WARNING: Only {bars_available} bars available, but MA period is \"\n                f\"{effective_ma_period}. No regime signals possible.\"\n            )\n            print(\"    Increase --period (e.g., 5y, 10y) or reduce --ma-period\")\n        return []\n    elif bars_available &lt; min_recommended:\n        if verbose:\n            print(\n                f\"\u26a0\ufe0f  WARNING: Only {bars_available} bars for {effective_ma_period}-period MA. \"\n                f\"Recommend {min_recommended}+ bars for reliable regime detection.\"\n            )\n            print(\"    Consider using --period 5y or --period 10y for better accuracy.\")\n\n    if verbose:\n        print(f\"Benchmark {benchmark}: {len(benchmark_df)} bars loaded\")\n        mode_msg = f\"batch size {batch_size}\" if batch_size else \"sequential\"\n        print(f\"Screening {len(tickers)} tickers ({mode_msg})...\")\n        print(\"-\" * 70)\n\n    # Screen tickers\n    if batch_size is not None and batch_size &gt; 0:\n        results = _screen_batch_mode(\n            tickers=tickers,\n            benchmark=benchmark,\n            benchmark_df=benchmark_df,\n            interval=interval,\n            lookback=lookback,\n            start=start,\n            end=end,\n            effective_ma_period=effective_ma_period,\n            beta_window=beta_window,\n            regime_filter=regime_filter,\n            min_price=min_price,\n            max_price=max_price,\n            min_volume=min_volume,\n            batch_size=batch_size,\n            verbose=verbose,\n        )\n    else:\n        results = _screen_sequential_mode(\n            tickers=tickers,\n            benchmark=benchmark,\n            benchmark_df=benchmark_df,\n            interval=interval,\n            lookback=lookback,\n            start=start,\n            end=end,\n            effective_ma_period=effective_ma_period,\n            beta_window=beta_window,\n            regime_filter=regime_filter,\n            min_price=min_price,\n            max_price=max_price,\n            min_volume=min_volume,\n            verbose=verbose,\n        )\n\n    if verbose:\n        print(\"-\" * 70)\n        print(f\"Screening complete. Found {len(results)} stocks matching criteria.\")\n\n    return sorted(results, key=lambda x: x.ticker)\n</code></pre>"},{"location":"api/beta_regime/#stockcharts.screener.beta_regime.save_results_to_csv","title":"<code>save_results_to_csv(results, filename='beta_regime_results.csv')</code>","text":"<p>Save screening results to CSV file.</p> <p>Parameters:</p> Name Type Description Default <code>results</code> <code>list[BetaRegimeResult]</code> <p>List of BetaRegimeResult objects to save.</p> required <code>filename</code> <code>str</code> <p>Output CSV file path.</p> <code>'beta_regime_results.csv'</code> <p>Returns:</p> Type Description <code>None</code> <p>None. Prints status message and writes file to disk.</p> Source code in <code>src/stockcharts/screener/beta_regime.py</code> <pre><code>def save_results_to_csv(\n    results: list[BetaRegimeResult],\n    filename: str = \"beta_regime_results.csv\",\n) -&gt; None:\n    \"\"\"Save screening results to CSV file.\n\n    Args:\n        results: List of BetaRegimeResult objects to save.\n        filename: Output CSV file path.\n\n    Returns:\n        None. Prints status message and writes file to disk.\n    \"\"\"\n    if not results:\n        print(\"No results to save.\")\n        return\n\n    df = pd.DataFrame(\n        [\n            {\n                \"Ticker\": r.ticker,\n                \"Company_Name\": r.company_name,\n                \"Benchmark\": r.benchmark,\n                \"Regime\": r.regime,\n                \"Relative_Strength\": r.relative_strength,\n                \"MA_Value\": r.ma_value,\n                \"Pct_From_MA\": r.pct_from_ma,\n                \"Beta\": r.beta,\n                \"Close_Price\": r.close_price,\n                \"Benchmark_Price\": r.benchmark_price,\n                \"Interval\": r.interval,\n                \"MA_Period\": r.ma_period,\n            }\n            for r in results\n        ]\n    )\n\n    df.to_csv(filename, index=False)\n    print(f\"Results saved to {filename}\")\n</code></pre>"},{"location":"api/data/","title":"Data Fetching","text":""},{"location":"api/data/#stockcharts.data.fetch","title":"<code>fetch</code>","text":"<p>Data fetching utilities using yfinance.</p> Function <p>fetch_ohlc(     ticker,     interval=\"1d\",     lookback: str | None = None,     start: str | None = None,     end: str | None = None,     auto_adjust: bool = False, )</p> Parameter semantics <ul> <li>interval: Aggregation interval for candles ('1d', '1wk', '1mo').</li> <li>lookback: Relative period for history breadth ('5d','1mo','3mo','6mo','1y','2y','5y','10y','ytd','max').</li> <li>start/end: Explicit date range (YYYY-MM-DD). If both provided they override lookback.   Passing values like '3mo' to start/end is invalid and will be ignored.</li> </ul> <p>We guard against accidentally sending a lookback string where a date is required by validating format.</p> <p>Returns a pandas DataFrame with columns: Open, High, Low, Close, Volume</p>"},{"location":"api/data/#stockcharts.data.fetch.fetch_ohlc","title":"<code>fetch_ohlc(ticker, interval='1d', lookback=None, start=None, end=None, auto_adjust=False)</code>","text":"<p>Fetch OHLC data for a single ticker.</p> <p>Parameters:</p> Name Type Description Default <code>ticker</code> <code>str</code> <p>Stock symbol to download.</p> required <code>interval</code> <code>str</code> <p>Aggregation interval ('1d', '1wk', '1mo').</p> <code>'1d'</code> <code>lookback</code> <code>str | None</code> <p>Relative period for history ('1y', '5y', 'max', etc.).</p> <code>None</code> <code>start</code> <code>str | None</code> <p>Start date YYYY-MM-DD (overrides lookback if end also provided).</p> <code>None</code> <code>end</code> <code>str | None</code> <p>End date YYYY-MM-DD.</p> <code>None</code> <code>auto_adjust</code> <code>bool</code> <p>Whether to adjust OHLC for splits/dividends.</p> <code>False</code> <p>Returns:</p> Type Description <code>DataFrame</code> <p>DataFrame with columns [Open, High, Low, Close, Volume].</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If data is empty or missing required columns.</p> Note <ul> <li>If both start and end are valid dates they override lookback.</li> <li>If either start/end is invalid (e.g. '3mo'), it is ignored.</li> <li>If nothing specified, default lookback = '1y'.</li> </ul> Source code in <code>src/stockcharts/data/fetch.py</code> <pre><code>def fetch_ohlc(\n    ticker: str,\n    interval: str = \"1d\",\n    lookback: str | None = None,\n    start: str | None = None,\n    end: str | None = None,\n    auto_adjust: bool = False,\n) -&gt; pd.DataFrame:\n    \"\"\"Fetch OHLC data for a single ticker.\n\n    Args:\n        ticker: Stock symbol to download.\n        interval: Aggregation interval ('1d', '1wk', '1mo').\n        lookback: Relative period for history ('1y', '5y', 'max', etc.).\n        start: Start date YYYY-MM-DD (overrides lookback if end also provided).\n        end: End date YYYY-MM-DD.\n        auto_adjust: Whether to adjust OHLC for splits/dividends.\n\n    Returns:\n        DataFrame with columns [Open, High, Low, Close, Volume].\n\n    Raises:\n        ValueError: If data is empty or missing required columns.\n\n    Note:\n        - If both start and end are valid dates they override lookback.\n        - If either start/end is invalid (e.g. '3mo'), it is ignored.\n        - If nothing specified, default lookback = '1y'.\n    \"\"\"\n    download_kwargs = _validate_and_build_download_kwargs(\n        interval, lookback, start, end, auto_adjust\n    )\n\n    df = yf.download(ticker, **download_kwargs)\n    return _normalize_single_ticker_df(df, ticker)\n</code></pre>"},{"location":"api/data/#stockcharts.data.fetch.fetch_ohlc_batch","title":"<code>fetch_ohlc_batch(tickers, interval='1d', lookback=None, start=None, end=None, auto_adjust=False, threads=True, progress=False)</code>","text":"<p>Fetch OHLC data for multiple tickers in a single batch request.</p> <p>Uses yfinance's built-in threading for parallel downloads, which is significantly faster than sequential single-ticker downloads.</p> <p>Parameters:</p> Name Type Description Default <code>tickers</code> <code>list[str]</code> <p>List of stock symbols to download.</p> required <code>interval</code> <code>str</code> <p>Aggregation interval ('1d', '1wk', '1mo').</p> <code>'1d'</code> <code>lookback</code> <code>str | None</code> <p>Relative period for history ('1y', '5y', 'max', etc.).</p> <code>None</code> <code>start</code> <code>str | None</code> <p>Start date YYYY-MM-DD (overrides lookback if end also provided).</p> <code>None</code> <code>end</code> <code>str | None</code> <p>End date YYYY-MM-DD.</p> <code>None</code> <code>auto_adjust</code> <code>bool</code> <p>Whether to adjust OHLC for splits/dividends.</p> <code>False</code> <code>threads</code> <code>bool</code> <p>Use multi-threading for faster downloads (default: True).</p> <code>True</code> <code>progress</code> <code>bool</code> <p>Show download progress bar (default: False).</p> <code>False</code> <p>Returns:</p> Type Description <code>dict[str, DataFrame]</code> <p>Dictionary mapping ticker symbols to their OHLC DataFrames.</p> <code>dict[str, DataFrame]</code> <p>Failed downloads are silently omitted from results.</p> Source code in <code>src/stockcharts/data/fetch.py</code> <pre><code>def fetch_ohlc_batch(\n    tickers: list[str],\n    interval: str = \"1d\",\n    lookback: str | None = None,\n    start: str | None = None,\n    end: str | None = None,\n    auto_adjust: bool = False,\n    threads: bool = True,\n    progress: bool = False,\n) -&gt; dict[str, pd.DataFrame]:\n    \"\"\"Fetch OHLC data for multiple tickers in a single batch request.\n\n    Uses yfinance's built-in threading for parallel downloads, which is\n    significantly faster than sequential single-ticker downloads.\n\n    Args:\n        tickers: List of stock symbols to download.\n        interval: Aggregation interval ('1d', '1wk', '1mo').\n        lookback: Relative period for history ('1y', '5y', 'max', etc.).\n        start: Start date YYYY-MM-DD (overrides lookback if end also provided).\n        end: End date YYYY-MM-DD.\n        auto_adjust: Whether to adjust OHLC for splits/dividends.\n        threads: Use multi-threading for faster downloads (default: True).\n        progress: Show download progress bar (default: False).\n\n    Returns:\n        Dictionary mapping ticker symbols to their OHLC DataFrames.\n        Failed downloads are silently omitted from results.\n    \"\"\"\n    if not tickers:\n        return {}\n\n    download_kwargs = _validate_and_build_download_kwargs(\n        interval, lookback, start, end, auto_adjust\n    )\n    download_kwargs[\"progress\"] = progress\n    download_kwargs[\"threads\"] = threads\n    download_kwargs[\"group_by\"] = \"ticker\"\n\n    # yfinance accepts list or space-separated string\n    batch_df = yf.download(tickers, **download_kwargs)\n\n    results: dict[str, pd.DataFrame] = {}\n\n    if batch_df.empty:\n        return results\n\n    # Handle single vs multiple ticker return format\n    if len(tickers) == 1:\n        # Single ticker: columns are just OHLCV\n        ticker = tickers[0]\n        try:\n            df = _normalize_single_ticker_df(batch_df.copy(), ticker)\n            results[ticker] = df\n        except ValueError:\n            pass  # Skip failed ticker\n    else:\n        # Multiple tickers: MultiIndex columns (ticker, OHLCV)\n        for ticker in tickers:\n            try:\n                if ticker not in batch_df.columns.get_level_values(0):\n                    continue\n\n                ticker_df = batch_df[ticker].copy()\n\n                # Drop rows where all values are NaN (no data for this date)\n                ticker_df = ticker_df.dropna(how=\"all\")\n\n                if ticker_df.empty:\n                    continue\n\n                # Standardize columns\n                ticker_df = ticker_df.reset_index().set_index(ticker_df.index.names[0])\n\n                needed = [\"Open\", \"High\", \"Low\", \"Close\", \"Volume\"]\n                missing = [c for c in needed if c not in ticker_df.columns]\n                if missing:\n                    continue\n\n                results[ticker] = ticker_df[needed].copy()\n            except Exception:\n                # Skip any ticker that fails processing\n                continue\n\n    return results\n</code></pre>"},{"location":"api/divergence/","title":"Divergence Detection","text":""},{"location":"api/divergence/#stockcharts.indicators.divergence","title":"<code>divergence</code>","text":"<p>Price vs RSI divergence detection utilities.</p> <p>Public API (selected):     detect_divergence(df, ...) -&gt; Dict[str, Any]     find_three_point_sequences(df, price_idx, rsi_idx, kind='low', ...) -&gt; List[Dict[str, Any]]</p> <p>All helper functions use explicit typing; tolerances tuned to reduce noise.</p>"},{"location":"api/divergence/#stockcharts.indicators.divergence.find_three_point_sequences","title":"<code>find_three_point_sequences(df, price_idx, rsi_idx, kind='low', price_col='Close', rsi_col='RSI', max_bar_gap=10, sequence_tolerance_pct=0.01, min_magnitude_atr_mult=0.5, atr_period=14, require_strict_order=False)</code>","text":"<p>Find and score 3-point divergence sequences from pivot indices.</p> <p>Returns candidate triples (3 consecutive pivots) that form valid divergence patterns, sorted by conviction score (higher = stronger signal).</p> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>DataFrame</code> <p>DataFrame with price and RSI data (typically tail(lookback))</p> required <code>price_idx</code> <code>Iterable</code> <p>Ordered pivot indices for price (timestamps from EMA-derivative or swing)</p> required <code>rsi_idx</code> <code>Iterable</code> <p>Ordered pivot indices for RSI</p> required <code>kind</code> <code>str</code> <p>'low' for bullish divergence (descending price, ascending RSI)   'high' for bearish divergence (ascending price, descending RSI)</p> <code>'low'</code> <code>price_col</code> <code>str</code> <p>Name of price column (default: 'Close')</p> <code>'Close'</code> <code>rsi_col</code> <code>str</code> <p>Name of RSI column (default: 'RSI')</p> <code>'RSI'</code> <code>max_bar_gap</code> <code>int</code> <p>Maximum bar distance between price and RSI pivots (default: 10)</p> <code>10</code> <code>sequence_tolerance_pct</code> <code>float</code> <p>Relative tolerance for price monotonicity (default: 0.01 = 1%)</p> <code>0.01</code> <code>min_magnitude_atr_mult</code> <code>float</code> <p>Minimum price move as multiple of ATR (default: 0.5)</p> <code>0.5</code> <code>atr_period</code> <code>int</code> <p>Period for ATR calculation (default: 14)</p> <code>14</code> <code>require_strict_order</code> <code>bool</code> <p>If True, enforce strict &lt; or &gt; (default: False allows tolerance)</p> <code>False</code> <p>Returns:</p> Type Description <code>list[dict[str, Any]]</code> <p>List[Dict[str, Any]] sorted by descending <code>score</code>. Each dict contains: kind, price_idx, rsi_idx, price_vals, rsi_vals, score, meta.</p> Source code in <code>src/stockcharts/indicators/divergence.py</code> <pre><code>def find_three_point_sequences(\n    df: pd.DataFrame,\n    price_idx: Iterable,\n    rsi_idx: Iterable,\n    kind: str = \"low\",\n    price_col: str = \"Close\",\n    rsi_col: str = \"RSI\",\n    max_bar_gap: int = 10,\n    sequence_tolerance_pct: float = 0.01,\n    min_magnitude_atr_mult: float = 0.5,\n    atr_period: int = 14,\n    require_strict_order: bool = False,\n) -&gt; list[dict[str, Any]]:\n    \"\"\"Find and score 3-point divergence sequences from pivot indices.\n\n    Returns candidate triples (3 consecutive pivots) that form valid divergence patterns,\n    sorted by conviction score (higher = stronger signal).\n\n    Args:\n        df: DataFrame with price and RSI data (typically tail(lookback))\n        price_idx: Ordered pivot indices for price (timestamps from EMA-derivative or swing)\n        rsi_idx: Ordered pivot indices for RSI\n        kind: 'low' for bullish divergence (descending price, ascending RSI)\n              'high' for bearish divergence (ascending price, descending RSI)\n        price_col: Name of price column (default: 'Close')\n        rsi_col: Name of RSI column (default: 'RSI')\n        max_bar_gap: Maximum bar distance between price and RSI pivots (default: 10)\n        sequence_tolerance_pct: Relative tolerance for price monotonicity (default: 0.01 = 1%)\n        min_magnitude_atr_mult: Minimum price move as multiple of ATR (default: 0.5)\n        atr_period: Period for ATR calculation (default: 14)\n        require_strict_order: If True, enforce strict &lt; or &gt; (default: False allows tolerance)\n\n    Returns:\n        List[Dict[str, Any]] sorted by descending ``score``. Each dict contains:\n            kind, price_idx, rsi_idx, price_vals, rsi_vals, score, meta.\n    \"\"\"\n    # Build position map for bar-distance calculations\n    pos = {idx: i for i, idx in enumerate(df.index)}\n    price_idx = [i for i in price_idx if i in pos]\n    rsi_idx = [i for i in rsi_idx if i in pos]\n\n    if len(price_idx) &lt; 3 or len(rsi_idx) &lt; 3:\n        return []\n\n    # Helper: find nearest RSI pivot by bar distance within max_bar_gap\n    def nearest_rsi(target_idx: int) -&gt; int | None:\n        tpos = pos[target_idx]\n        best = None\n        best_gap = max_bar_gap + 1\n        for c in rsi_idx:\n            gap = abs(pos[c] - tpos)\n            if gap &lt;= max_bar_gap and gap &lt; best_gap:\n                best_gap = gap\n                best = c\n        return best\n\n    # Precompute ATR for magnitude filtering\n    atr = _compute_atr(df, period=atr_period)\n\n    candidates = []\n\n    # Slide window of 3 consecutive price pivots\n    for i in range(len(price_idx) - 2):\n        p1_idx, p2_idx, p3_idx = price_idx[i], price_idx[i + 1], price_idx[i + 2]\n\n        # Ensure reasonable bar separation (avoid ultra-tight clusters)\n        if abs(pos[p3_idx] - pos[p1_idx]) &lt; 2:\n            continue\n\n        # Map each price pivot to nearest RSI pivot\n        r1_idx = nearest_rsi(p1_idx)\n        r2_idx = nearest_rsi(p2_idx)\n        r3_idx = nearest_rsi(p3_idx)\n\n        if not (r1_idx and r2_idx and r3_idx):\n            continue\n\n        # Extract values\n        p1 = float(df.at[p1_idx, price_col])\n        p2 = float(df.at[p2_idx, price_col])\n        p3 = float(df.at[p3_idx, price_col])\n        r1 = float(df.at[r1_idx, rsi_col])\n        r2 = float(df.at[r2_idx, rsi_col])\n        r3 = float(df.at[r3_idx, rsi_col])\n\n        # Check monotonicity with tolerance\n        if kind == \"low\":\n            # Bullish divergence: price descending, RSI ascending\n            if require_strict_order:\n                ok_price = (p2 &lt; p1) and (p3 &lt; p2)\n                ok_rsi = (r2 &gt; r1) and (r3 &gt; r2)\n            else:\n                ok_price = (p2 &lt;= p1 * (1 + sequence_tolerance_pct)) and (\n                    p3 &lt;= p2 * (1 + sequence_tolerance_pct)\n                )\n                ok_rsi = (r2 &gt;= r1 - 0.5) and (r3 &gt;= r2 - 0.5)\n        else:  # 'high'\n            # Bearish divergence: price ascending, RSI descending\n            if require_strict_order:\n                ok_price = (p2 &gt; p1) and (p3 &gt; p2)\n                ok_rsi = (r2 &lt; r1) and (r3 &lt; r2)\n            else:\n                ok_price = (p2 &gt;= p1 * (1 - sequence_tolerance_pct)) and (\n                    p3 &gt;= p2 * (1 - sequence_tolerance_pct)\n                )\n                ok_rsi = (r2 &lt;= r1 + 0.5) and (r3 &lt;= r2 + 0.5)\n\n        if not (ok_price and ok_rsi):\n            continue\n\n        # Magnitude filter: at least one leg must exceed ATR threshold\n        atr_p1 = float(atr.at[p1_idx]) if p1_idx in atr.index else np.nan\n        atr_p2 = float(atr.at[p2_idx]) if p2_idx in atr.index else np.nan\n        atr_p3 = float(atr.at[p3_idx]) if p3_idx in atr.index else np.nan\n\n        span12 = abs(p1 - p2)\n        span23 = abs(p2 - p3)\n\n        mag_ok = False\n        if not np.isnan(atr_p1) and atr_p1 &gt; 0 and span12 &gt;= min_magnitude_atr_mult * atr_p1:\n            mag_ok = True\n        if not np.isnan(atr_p2) and atr_p2 &gt; 0 and span23 &gt;= min_magnitude_atr_mult * atr_p2:\n            mag_ok = True\n\n        if not mag_ok:\n            continue\n\n        # Compute conviction score: (normalized price span) + (RSI delta)\n        score = 0.0\n        if not np.isnan(atr_p2) and atr_p2 &gt; 0:\n            score += (span12 + span23) / (atr_p2 * 2.0)\n\n        # Add RSI contribution\n        if kind == \"low\":\n            score += ((r2 - r1) + (r3 - r2)) / 10.0  # Scale RSI delta\n        else:\n            score += ((r1 - r2) + (r2 - r3)) / 10.0\n\n        candidates.append(\n            {\n                \"kind\": kind,\n                \"price_idx\": (p1_idx, p2_idx, p3_idx),\n                \"rsi_idx\": (r1_idx, r2_idx, r3_idx),\n                \"price_vals\": (p1, p2, p3),\n                \"rsi_vals\": (r1, r2, r3),\n                \"score\": float(score),\n                \"meta\": {\n                    \"span12\": span12,\n                    \"span23\": span23,\n                    \"atr_p1\": atr_p1,\n                    \"atr_p2\": atr_p2,\n                    \"atr_p3\": atr_p3,\n                },\n            }\n        )\n\n    # Sort by score descending (highest conviction first)\n    candidates.sort(key=lambda x: float(x[\"score\"]), reverse=True)  # type: ignore[arg-type]\n    return candidates\n</code></pre>"},{"location":"api/divergence/#stockcharts.indicators.divergence.find_swing_points","title":"<code>find_swing_points(series, window=5)</code>","text":"<p>Find swing highs and lows in a price or indicator series.</p> <p>A swing high is a local maximum (higher than surrounding points). A swing low is a local minimum (lower than surrounding points).</p> <p>Parameters:</p> Name Type Description Default <code>series</code> <code>Series</code> <p>Price or indicator series</p> required <code>window</code> <code>int</code> <p>Number of bars on each side to compare (default: 5)</p> <code>5</code> <p>Returns:</p> Type Description <code>tuple[Series, Series]</code> <p>Tuple of (swing_highs, swing_lows) where each is a Series with values at swing points</p> Source code in <code>src/stockcharts/indicators/divergence.py</code> <pre><code>def find_swing_points(series: pd.Series, window: int = 5) -&gt; tuple[pd.Series, pd.Series]:\n    \"\"\"Find swing highs and lows in a price or indicator series.\n\n    A swing high is a local maximum (higher than surrounding points).\n    A swing low is a local minimum (lower than surrounding points).\n\n    Args:\n        series: Price or indicator series\n        window: Number of bars on each side to compare (default: 5)\n\n    Returns:\n        Tuple of (swing_highs, swing_lows) where each is a Series with values at swing points\n    \"\"\"\n    swing_highs = pd.Series(index=series.index, dtype=float)\n    swing_lows = pd.Series(index=series.index, dtype=float)\n\n    for i in range(window, len(series) - window):\n        # Check if current point is a swing high\n        is_high = True\n        for j in range(-window, window + 1):\n            if j != 0 and series.iloc[i] &lt;= series.iloc[i + j]:\n                is_high = False\n                break\n        if is_high:\n            swing_highs.iloc[i] = series.iloc[i]\n\n        # Check if current point is a swing low\n        is_low = True\n        for j in range(-window, window + 1):\n            if j != 0 and series.iloc[i] &gt;= series.iloc[i + j]:\n                is_low = False\n                break\n        if is_low:\n            swing_lows.iloc[i] = series.iloc[i]\n\n    return swing_highs, swing_lows\n</code></pre>"},{"location":"api/divergence/#stockcharts.indicators.divergence.detect_divergence","title":"<code>detect_divergence(df, price_col='Close', rsi_col='RSI', window=5, lookback=60, min_swing_points=2, index_proximity_factor=2, sequence_tolerance_pct=0.002, rsi_sequence_tolerance=0.0, pivot_method='swing', zigzag_pct=0.03, zigzag_atr_mult=2.0, zigzag_atr_period=14, ema_price_span=5, ema_rsi_span=5, use_sequence_scoring=False, min_sequence_score=1.0, max_bar_gap=10, min_magnitude_atr_mult=0.5, atr_period=14)</code>","text":"<p>Detect bullish and bearish divergences between price and RSI.</p> <p>Bullish Divergence (potential reversal up): - Price makes lower lows (2 or 3 points) - RSI makes higher lows (2 or 3 points) - Indicates weakening downtrend</p> <p>Bearish Divergence (potential reversal down): - Price makes higher highs (2 or 3 points) - RSI makes lower highs (2 or 3 points) - Indicates weakening uptrend</p> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>DataFrame</code> <p>DataFrame with price and RSI columns</p> required <code>price_col</code> <code>str</code> <p>Name of price column (default: 'Close')</p> <code>'Close'</code> <code>rsi_col</code> <code>str</code> <p>Name of RSI column (default: 'RSI')</p> <code>'RSI'</code> <code>window</code> <code>int</code> <p>Window for swing point detection (default: 5)</p> <code>5</code> <code>lookback</code> <code>int</code> <p>Number of bars to look back for divergence (default: 60)</p> <code>60</code> <code>min_swing_points</code> <code>int</code> <p>Minimum swing points required (2 or 3, default: 2)</p> <code>2</code> <code>index_proximity_factor</code> <code>int</code> <p>Multiplier for window to allow bar index gap tolerance (default: 2)</p> <code>2</code> <code>sequence_tolerance_pct</code> <code>float</code> <p>Relative tolerance for 3-point price sequences (default: 0.002 = 0.2%)</p> <code>0.002</code> <code>rsi_sequence_tolerance</code> <code>float</code> <p>Extra RSI tolerance in points for 3-point sequences (default: 0.0)</p> <code>0.0</code> <code>pivot_method</code> <code>str</code> <p>Method for detecting pivots - 'swing' or 'ema-deriv' (default: 'swing')</p> <code>'swing'</code> <code>zigzag_pct</code> <code>float</code> <p>[DEPRECATED] Not used</p> <code>0.03</code> <code>zigzag_atr_mult</code> <code>float</code> <p>[DEPRECATED] Not used</p> <code>2.0</code> <code>zigzag_atr_period</code> <code>int</code> <p>[DEPRECATED] Not used</p> <code>14</code> <code>ema_price_span</code> <code>int</code> <p>EMA smoothing span for price when using ema-deriv (default: 5)</p> <code>5</code> <code>ema_rsi_span</code> <code>int</code> <p>EMA smoothing span for RSI when using ema-deriv (default: 5)</p> <code>5</code> <code>use_sequence_scoring</code> <code>bool</code> <p>Enable ATR-normalized 3-point scoring (default: False)</p> <code>False</code> <code>min_sequence_score</code> <code>float</code> <p>Minimum score to accept a 3-point sequence (default: 1.0)</p> <code>1.0</code> <code>max_bar_gap</code> <code>int</code> <p>Max bar distance between price and RSI pivots for scoring (default: 10)</p> <code>10</code> <code>min_magnitude_atr_mult</code> <code>float</code> <p>Min price move as ATR multiple for scoring (default: 0.5)</p> <code>0.5</code> <code>atr_period</code> <code>int</code> <p>ATR period for magnitude filtering (default: 14)</p> <code>14</code> <p>Returns:</p> Type Description <code>dict[str, Any]</code> <p>Dict[str, Any] with keys: bullish, bearish, bullish_details, bearish_details,</p> <code>dict[str, Any]</code> <p>last_signal, bullish_indices, bearish_indices, bullish_score, bearish_score.</p> Source code in <code>src/stockcharts/indicators/divergence.py</code> <pre><code>def detect_divergence(\n    df: pd.DataFrame,\n    price_col: str = \"Close\",\n    rsi_col: str = \"RSI\",\n    window: int = 5,\n    lookback: int = 60,\n    min_swing_points: int = 2,\n    index_proximity_factor: int = 2,\n    sequence_tolerance_pct: float = 0.002,\n    rsi_sequence_tolerance: float = 0.0,\n    pivot_method: str = \"swing\",\n    zigzag_pct: float = 0.03,\n    zigzag_atr_mult: float = 2.0,\n    zigzag_atr_period: int = 14,\n    ema_price_span: int = 5,\n    ema_rsi_span: int = 5,\n    use_sequence_scoring: bool = False,\n    min_sequence_score: float = 1.0,\n    max_bar_gap: int = 10,\n    min_magnitude_atr_mult: float = 0.5,\n    atr_period: int = 14,\n) -&gt; dict[str, Any]:\n    \"\"\"Detect bullish and bearish divergences between price and RSI.\n\n    Bullish Divergence (potential reversal up):\n    - Price makes lower lows (2 or 3 points)\n    - RSI makes higher lows (2 or 3 points)\n    - Indicates weakening downtrend\n\n    Bearish Divergence (potential reversal down):\n    - Price makes higher highs (2 or 3 points)\n    - RSI makes lower highs (2 or 3 points)\n    - Indicates weakening uptrend\n\n    Args:\n        df: DataFrame with price and RSI columns\n        price_col: Name of price column (default: 'Close')\n        rsi_col: Name of RSI column (default: 'RSI')\n        window: Window for swing point detection (default: 5)\n        lookback: Number of bars to look back for divergence (default: 60)\n        min_swing_points: Minimum swing points required (2 or 3, default: 2)\n        index_proximity_factor: Multiplier for window to allow bar index gap tolerance (default: 2)\n        sequence_tolerance_pct: Relative tolerance for 3-point price sequences (default: 0.002 = 0.2%)\n        rsi_sequence_tolerance: Extra RSI tolerance in points for 3-point sequences (default: 0.0)\n        pivot_method: Method for detecting pivots - 'swing' or 'ema-deriv' (default: 'swing')\n        zigzag_pct: [DEPRECATED] Not used\n        zigzag_atr_mult: [DEPRECATED] Not used\n        zigzag_atr_period: [DEPRECATED] Not used\n        ema_price_span: EMA smoothing span for price when using ema-deriv (default: 5)\n        ema_rsi_span: EMA smoothing span for RSI when using ema-deriv (default: 5)\n        use_sequence_scoring: Enable ATR-normalized 3-point scoring (default: False)\n        min_sequence_score: Minimum score to accept a 3-point sequence (default: 1.0)\n        max_bar_gap: Max bar distance between price and RSI pivots for scoring (default: 10)\n        min_magnitude_atr_mult: Min price move as ATR multiple for scoring (default: 0.5)\n        atr_period: ATR period for magnitude filtering (default: 14)\n\n    Returns:\n        Dict[str, Any] with keys: bullish, bearish, bullish_details, bearish_details,\n        last_signal, bullish_indices, bearish_indices, bullish_score, bearish_score.\n    \"\"\"\n    result = {\n        \"bullish\": False,\n        \"bearish\": False,\n        \"bullish_details\": \"\",\n        \"bearish_details\": \"\",\n        \"last_signal\": \"none\",\n        \"bullish_indices\": None,\n        \"bearish_indices\": None,\n        \"bullish_score\": 0.0,\n        \"bearish_score\": 0.0,\n    }\n\n    if len(df) &lt; lookback:\n        return result\n\n    # Use only recent data\n    recent_df = df.tail(lookback).copy()\n\n    # Find swing points in price and RSI using selected method\n    if pivot_method == \"ema-deriv\":\n        # Use EMA-derivative pivot detection\n        pivots_dict = ema_derivative_pivots(\n            recent_df,\n            price_col=price_col,\n            rsi_col=rsi_col,\n            price_span=ema_price_span,\n            rsi_span=ema_rsi_span,\n        )\n        price_high_idx = pivots_dict[\"price_highs\"]\n        price_low_idx = pivots_dict[\"price_lows\"]\n        rsi_high_idx = pivots_dict[\"rsi_highs\"]\n        rsi_low_idx = pivots_dict[\"rsi_lows\"]\n    else:\n        # Traditional window-based swing point detection\n        price_highs, price_lows = find_swing_points(recent_df[price_col], window)\n        rsi_highs, rsi_lows = find_swing_points(recent_df[rsi_col], window)\n\n        # Get indices where swing points exist\n        price_high_idx = price_highs.dropna().index\n        price_low_idx = price_lows.dropna().index\n        rsi_high_idx = rsi_highs.dropna().index\n        rsi_low_idx = rsi_lows.dropna().index\n\n    # Precompute positional indices for bar-distance based alignment (handles weekends/holidays)\n    pos_map = {idx: i for i, idx in enumerate(recent_df.index)}\n    max_bar_gap_fallback = window * index_proximity_factor\n\n    def nearest_by_bar(target_idx: int, candidates: list[int]) -&gt; int | None:\n        \"\"\"Return candidate with smallest absolute bar index distance within max_bar_gap.\"\"\"\n        if target_idx not in pos_map:\n            return None\n        tpos = pos_map[target_idx]\n        viable = [\n            (abs(pos_map[c] - tpos), c)\n            for c in candidates\n            if c in pos_map and abs(pos_map[c] - tpos) &lt;= max_bar_gap_fallback\n        ]\n        if not viable:\n            return None\n        return min(viable)[1]\n\n    # NEW: Use advanced 3-point sequence scoring if enabled\n    if use_sequence_scoring and min_swing_points == 3:\n        # Find scored 3-point sequences\n        bullish_candidates = find_three_point_sequences(\n            recent_df,\n            price_idx=price_low_idx,\n            rsi_idx=rsi_low_idx,\n            kind=\"low\",\n            price_col=price_col,\n            rsi_col=rsi_col,\n            max_bar_gap=max_bar_gap,\n            sequence_tolerance_pct=sequence_tolerance_pct,\n            min_magnitude_atr_mult=min_magnitude_atr_mult,\n            atr_period=atr_period,\n            require_strict_order=False,\n        )\n\n        bearish_candidates = find_three_point_sequences(\n            recent_df,\n            price_idx=price_high_idx,\n            rsi_idx=rsi_high_idx,\n            kind=\"high\",\n            price_col=price_col,\n            rsi_col=rsi_col,\n            max_bar_gap=max_bar_gap,\n            sequence_tolerance_pct=sequence_tolerance_pct,\n            min_magnitude_atr_mult=min_magnitude_atr_mult,\n            atr_period=atr_period,\n            require_strict_order=False,\n        )\n\n        # Take best bullish candidate above threshold\n        if bullish_candidates and bullish_candidates[0][\"score\"] &gt;= min_sequence_score:\n            best = bullish_candidates[0]\n            p1_idx, p2_idx, p3_idx = best[\"price_idx\"]\n            r1_idx, r2_idx, r3_idx = best[\"rsi_idx\"]\n            p1, p2, p3 = best[\"price_vals\"]\n            r1, r2, r3 = best[\"rsi_vals\"]\n\n            result[\"bullish\"] = True\n            result[\"bullish_score\"] = best[\"score\"]\n            result[\"bullish_details\"] = (\n                f\"3-Point (score={best['score']:.2f}): \"\n                f\"Price {p1:.2f}\u2192{p2:.2f}\u2192{p3:.2f} (descending) | \"\n                f\"RSI {r1:.2f}\u2192{r2:.2f}\u2192{r3:.2f} (ascending)\"\n            )\n            result[\"last_signal\"] = \"bullish\"\n            result[\"bullish_indices\"] = (p1_idx, p2_idx, p3_idx, r1_idx, r2_idx, r3_idx)\n\n        # Take best bearish candidate above threshold\n        if bearish_candidates and bearish_candidates[0][\"score\"] &gt;= min_sequence_score:\n            best = bearish_candidates[0]\n            p1_idx, p2_idx, p3_idx = best[\"price_idx\"]\n            r1_idx, r2_idx, r3_idx = best[\"rsi_idx\"]\n            p1, p2, p3 = best[\"price_vals\"]\n            r1, r2, r3 = best[\"rsi_vals\"]\n\n            result[\"bearish\"] = True\n            result[\"bearish_score\"] = best[\"score\"]\n            result[\"bearish_details\"] = (\n                f\"3-Point (score={best['score']:.2f}): \"\n                f\"Price {p1:.2f}\u2192{p2:.2f}\u2192{p3:.2f} (ascending) | \"\n                f\"RSI {r1:.2f}\u2192{r2:.2f}\u2192{r3:.2f} (descending)\"\n            )\n            if result[\"last_signal\"] == \"none\":\n                result[\"last_signal\"] = \"bearish\"\n            result[\"bearish_indices\"] = (p1_idx, p2_idx, p3_idx, r1_idx, r2_idx, r3_idx)\n\n        # Return early if scoring found valid signals\n        if result[\"bullish\"] or result[\"bearish\"]:\n            return result\n\n    # FALLBACK: Standard divergence detection (original logic)\n    # Detect Bullish Divergence (price lower lows, RSI higher lows)\n    if len(price_low_idx) &gt;= min_swing_points and len(rsi_low_idx) &gt;= min_swing_points:\n        # Try 3-point divergence first if requested\n        if min_swing_points == 3 and len(price_low_idx) &gt;= 3 and len(rsi_low_idx) &gt;= 3:\n            p1_idx, p2_idx, p3_idx = (\n                price_low_idx[-3],\n                price_low_idx[-2],\n                price_low_idx[-1],\n            )\n\n            # Find corresponding RSI lows using bar distance instead of calendar days\n            r1_idx = nearest_by_bar(p1_idx, rsi_low_idx)\n            r2_idx = nearest_by_bar(p2_idx, rsi_low_idx)\n            r3_idx = nearest_by_bar(p3_idx, rsi_low_idx)\n\n            if r1_idx and r2_idx and r3_idx:\n                p1 = recent_df.loc[p1_idx, price_col]\n                p2 = recent_df.loc[p2_idx, price_col]\n                p3 = recent_df.loc[p3_idx, price_col]\n\n                # Allow slight tolerance: each next low should be materially lower\n                # p2 &lt;= p1 * (1 - tolerance) and p3 &lt;= p2 * (1 - tolerance)\n                price_desc = (p2 &lt;= p1 * (1 - sequence_tolerance_pct)) and (\n                    p3 &lt;= p2 * (1 - sequence_tolerance_pct)\n                )\n\n                r1 = recent_df.loc[r1_idx, rsi_col]\n                r2 = recent_df.loc[r2_idx, rsi_col]\n                r3 = recent_df.loc[r3_idx, rsi_col]\n\n                # RSI should be ascending with tolerance\n                rsi_asc = (r2 - r1 &gt;= max(BULLISH_RSI_TOLERANCE, rsi_sequence_tolerance)) and (\n                    r3 - r2 &gt;= max(BULLISH_RSI_TOLERANCE, rsi_sequence_tolerance)\n                )\n\n                if price_desc and rsi_asc:\n                    result[\"bullish\"] = True\n                    result[\"bullish_details\"] = (\n                        f\"3-Point: Price {p1:.2f}\u2192{p2:.2f}\u2192{p3:.2f} (descending) | \"\n                        f\"RSI {r1:.2f}\u2192{r2:.2f}\u2192{r3:.2f} (ascending)\"\n                    )\n                    result[\"last_signal\"] = \"bullish\"\n                    result[\"bullish_indices\"] = (\n                        p1_idx,\n                        p2_idx,\n                        p3_idx,\n                        r1_idx,\n                        r2_idx,\n                        r3_idx,\n                    )\n\n        # Fall back to 2-point if 3-point not found or min_swing_points==2\n        if not result[\"bullish\"] and len(price_low_idx) &gt;= 2 and len(rsi_low_idx) &gt;= 2:\n            p1_idx, p2_idx = price_low_idx[-2], price_low_idx[-1]\n\n            # Find corresponding RSI lows using bar distance\n            r1_idx = nearest_by_bar(p1_idx, rsi_low_idx)\n            r2_idx = nearest_by_bar(p2_idx, rsi_low_idx)\n\n            if r1_idx and r2_idx:\n                p1 = recent_df.loc[p1_idx, price_col]\n                p2 = recent_df.loc[p2_idx, price_col]\n                r1 = recent_df.loc[r1_idx, rsi_col]\n                r2 = recent_df.loc[r2_idx, rsi_col]\n\n                price_ll = p2 &lt; p1\n                # RSI must be at least BULLISH_RSI_TOLERANCE points higher to confirm divergence\n                rsi_hl = r2 - r1 &gt;= BULLISH_RSI_TOLERANCE\n\n                if price_ll and rsi_hl:\n                    result[\"bullish\"] = True\n                    result[\"bullish_details\"] = (\n                        f\"Price {p1:.2f}\u2192{p2:.2f} (LL) | RSI {r1:.2f}\u2192{r2:.2f} (HL)\"\n                    )\n                    result[\"last_signal\"] = \"bullish\"\n                    result[\"bullish_indices\"] = (p1_idx, p2_idx, r1_idx, r2_idx)\n\n    # Detect Bearish Divergence (price higher highs, RSI lower highs)\n    if len(price_high_idx) &gt;= min_swing_points and len(rsi_high_idx) &gt;= min_swing_points:\n        # Try 3-point divergence first if requested\n        if min_swing_points == 3 and len(price_high_idx) &gt;= 3 and len(rsi_high_idx) &gt;= 3:\n            p1_idx, p2_idx, p3_idx = (\n                price_high_idx[-3],\n                price_high_idx[-2],\n                price_high_idx[-1],\n            )\n\n            # Find corresponding RSI highs using bar distance\n            r1_idx = nearest_by_bar(p1_idx, rsi_high_idx)\n            r2_idx = nearest_by_bar(p2_idx, rsi_high_idx)\n            r3_idx = nearest_by_bar(p3_idx, rsi_high_idx)\n\n            if r1_idx and r2_idx and r3_idx:\n                p1 = recent_df.loc[p1_idx, price_col]\n                p2 = recent_df.loc[p2_idx, price_col]\n                p3 = recent_df.loc[p3_idx, price_col]\n\n                # Allow slight tolerance: each next high should be materially higher\n                # p2 &gt;= p1 * (1 + tolerance) and p3 &gt;= p2 * (1 + tolerance)\n                price_asc = (p2 &gt;= p1 * (1 + sequence_tolerance_pct)) and (\n                    p3 &gt;= p2 * (1 + sequence_tolerance_pct)\n                )\n\n                r1 = recent_df.loc[r1_idx, rsi_col]\n                r2 = recent_df.loc[r2_idx, rsi_col]\n                r3 = recent_df.loc[r3_idx, rsi_col]\n\n                # RSI should be descending with tolerance\n                rsi_desc = (r1 - r2 &gt;= max(BEARISH_RSI_TOLERANCE, rsi_sequence_tolerance)) and (\n                    r2 - r3 &gt;= max(BEARISH_RSI_TOLERANCE, rsi_sequence_tolerance)\n                )\n\n                if price_asc and rsi_desc:\n                    result[\"bearish\"] = True\n                    result[\"bearish_details\"] = (\n                        f\"3-Point: Price {p1:.2f}\u2192{p2:.2f}\u2192{p3:.2f} (ascending) | \"\n                        f\"RSI {r1:.2f}\u2192{r2:.2f}\u2192{r3:.2f} (descending)\"\n                    )\n                    if result[\"last_signal\"] == \"none\":\n                        result[\"last_signal\"] = \"bearish\"\n                    result[\"bearish_indices\"] = (\n                        p1_idx,\n                        p2_idx,\n                        p3_idx,\n                        r1_idx,\n                        r2_idx,\n                        r3_idx,\n                    )\n\n        # Fall back to 2-point if 3-point not found or min_swing_points==2\n        if not result[\"bearish\"] and len(price_high_idx) &gt;= 2 and len(rsi_high_idx) &gt;= 2:\n            p1_idx, p2_idx = price_high_idx[-2], price_high_idx[-1]\n\n            # Find corresponding RSI highs using bar distance\n            r1_idx = nearest_by_bar(p1_idx, rsi_high_idx)\n            r2_idx = nearest_by_bar(p2_idx, rsi_high_idx)\n\n            if r1_idx and r2_idx:\n                p1 = recent_df.loc[p1_idx, price_col]\n                p2 = recent_df.loc[p2_idx, price_col]\n                r1 = recent_df.loc[r1_idx, rsi_col]\n                r2 = recent_df.loc[r2_idx, rsi_col]\n\n                price_hh = p2 &gt; p1\n                # RSI must be at least BEARISH_RSI_TOLERANCE points lower to confirm divergence\n                rsi_lh = r1 - r2 &gt;= BEARISH_RSI_TOLERANCE\n\n                if price_hh and rsi_lh:\n                    result[\"bearish\"] = True\n                    result[\"bearish_details\"] = (\n                        f\"Price {p1:.2f}\u2192{p2:.2f} (HH) | RSI {r1:.2f}\u2192{r2:.2f} (LH)\"\n                    )\n                    if result[\"last_signal\"] == \"none\":\n                        result[\"last_signal\"] = \"bearish\"\n                    result[\"bearish_indices\"] = (p1_idx, p2_idx, r1_idx, r2_idx)\n\n    return result\n</code></pre>"},{"location":"api/divergence/#stockcharts.indicators.divergence.check_breakout_occurred","title":"<code>check_breakout_occurred(df, divergence_idx, divergence_type, threshold=0.05, price_col='Close')</code>","text":"<p>Check if a breakout has already occurred after divergence detection.</p> <p>For bullish divergence: Price moved up significantly from divergence point. For bearish divergence: Price moved down significantly from divergence point.</p> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>DataFrame</code> <p>DataFrame with price data</p> required <code>divergence_idx</code> <code>Timestamp</code> <p>Index of the divergence point (second swing low/high)</p> required <code>divergence_type</code> <code>str</code> <p>'bullish' or 'bearish'</p> required <code>threshold</code> <code>float</code> <p>Percentage move required to consider it a breakout (default: 0.05 = 5%)</p> <code>0.05</code> <code>price_col</code> <code>str</code> <p>Name of price column (default: 'Close')</p> <code>'Close'</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if breakout already occurred (signal is stale), False if still valid</p> Source code in <code>src/stockcharts/indicators/divergence.py</code> <pre><code>def check_breakout_occurred(\n    df: pd.DataFrame,\n    divergence_idx: pd.Timestamp,\n    divergence_type: str,\n    threshold: float = 0.05,\n    price_col: str = \"Close\",\n) -&gt; bool:\n    \"\"\"Check if a breakout has already occurred after divergence detection.\n\n    For bullish divergence: Price moved up significantly from divergence point.\n    For bearish divergence: Price moved down significantly from divergence point.\n\n    Args:\n        df: DataFrame with price data\n        divergence_idx: Index of the divergence point (second swing low/high)\n        divergence_type: 'bullish' or 'bearish'\n        threshold: Percentage move required to consider it a breakout (default: 0.05 = 5%)\n        price_col: Name of price column (default: 'Close')\n\n    Returns:\n        True if breakout already occurred (signal is stale), False if still valid\n    \"\"\"\n    if divergence_idx not in df.index:\n        return False\n\n    divergence_price = df.loc[divergence_idx, price_col]\n    current_price = df[price_col].iloc[-1]\n\n    if divergence_type == \"bullish\":\n        # Bullish divergence: check if price already rallied past threshold\n        breakout_price = divergence_price * (1 + threshold)\n        return current_price &gt;= breakout_price\n\n    elif divergence_type == \"bearish\":\n        # Bearish divergence: check if price already dropped past threshold\n        breakout_price = divergence_price * (1 - threshold)\n        return current_price &lt;= breakout_price\n\n    return False\n</code></pre>"},{"location":"api/divergence/#stockcharts.indicators.divergence.check_failed_breakout","title":"<code>check_failed_breakout(df, divergence_idx, divergence_type, lookback_window=10, attempt_threshold=0.03, reversal_threshold=0.01, price_col='Close')</code>","text":"<p>Check if divergence led to a failed breakout attempt.</p> <p>A failed breakout means price tried to move in the divergence direction but reversed and closed back near/below the divergence level.</p> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>DataFrame</code> <p>DataFrame with price data</p> required <code>divergence_idx</code> <code>Timestamp</code> <p>Index of the divergence point</p> required <code>divergence_type</code> <code>str</code> <p>'bullish' or 'bearish'</p> required <code>lookback_window</code> <code>int</code> <p>Number of recent bars to check (default: 10)</p> <code>10</code> <code>attempt_threshold</code> <code>float</code> <p>% move required to consider an \"attempt\" (default: 0.03 = 3%)</p> <code>0.03</code> <code>reversal_threshold</code> <code>float</code> <p>% from divergence price to consider \"failed\" (default: 0.01 = 1%)</p> <code>0.01</code> <code>price_col</code> <code>str</code> <p>Name of price column (default: 'Close')</p> <code>'Close'</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if failed breakout detected (signal is weak), False otherwise</p> Source code in <code>src/stockcharts/indicators/divergence.py</code> <pre><code>def check_failed_breakout(\n    df: pd.DataFrame,\n    divergence_idx: pd.Timestamp,\n    divergence_type: str,\n    lookback_window: int = 10,\n    attempt_threshold: float = 0.03,\n    reversal_threshold: float = 0.01,\n    price_col: str = \"Close\",\n) -&gt; bool:\n    \"\"\"Check if divergence led to a failed breakout attempt.\n\n    A failed breakout means price tried to move in the divergence direction\n    but reversed and closed back near/below the divergence level.\n\n    Args:\n        df: DataFrame with price data\n        divergence_idx: Index of the divergence point\n        divergence_type: 'bullish' or 'bearish'\n        lookback_window: Number of recent bars to check (default: 10)\n        attempt_threshold: % move required to consider an \"attempt\" (default: 0.03 = 3%)\n        reversal_threshold: % from divergence price to consider \"failed\" (default: 0.01 = 1%)\n        price_col: Name of price column (default: 'Close')\n\n    Returns:\n        True if failed breakout detected (signal is weak), False otherwise\n    \"\"\"\n    if divergence_idx not in df.index:\n        return False\n\n    # Get data after divergence point\n    div_loc = df.index.get_loc(divergence_idx)\n    if div_loc &gt;= len(df) - 1:\n        return False  # No data after divergence\n\n    recent_data = df.iloc[div_loc : div_loc + lookback_window + 1]\n    if len(recent_data) &lt; 2:\n        return False\n\n    divergence_price = df.loc[divergence_idx, price_col]\n    current_close = df[price_col].iloc[-1]\n\n    if divergence_type == \"bullish\":\n        # Check for failed bullish attempt\n        attempted_high = recent_data[\"High\"].max()\n        attempt_target = divergence_price * (1 + attempt_threshold)\n        failed_level = divergence_price * (1 + reversal_threshold)\n\n        # Price tried to rally (reached attempt threshold) but closed back low\n        if attempted_high &gt;= attempt_target and current_close &lt; failed_level:\n            return True\n\n    elif divergence_type == \"bearish\":\n        # Check for failed bearish attempt\n        attempted_low = recent_data[\"Low\"].min()\n        attempt_target = divergence_price * (1 - attempt_threshold)\n        failed_level = divergence_price * (1 - reversal_threshold)\n\n        # Price tried to drop (reached attempt threshold) but closed back high\n        if attempted_low &lt;= attempt_target and current_close &gt; failed_level:\n            return True\n\n    return False\n</code></pre>"},{"location":"api/heiken_runs/","title":"Heiken Ashi Runs","text":"<p>Metrics for assessing trend maturity via consecutive same-color Heiken Ashi candles.</p>"},{"location":"api/heiken_runs/#overview","title":"Overview","text":"<p>The run statistics module computes: - <code>run_length</code>: Number of consecutive same-color (green or red) Heiken Ashi candles ending at the latest bar. - <code>run_percentile</code>: Inclusive percentile rank (0\u2013100) of <code>run_length</code> relative to the empirical distribution of all historical run lengths in the fetched dataset.</p> <p>Inclusive percentile formula:</p> <pre><code>(count of historical runs &lt;= current run_length) / (total runs) * 100\n</code></pre> <p>This treats ties as fully counted, emphasizing rarity of long streaks.</p>"},{"location":"api/heiken_runs/#use-cases","title":"Use Cases","text":"<ul> <li>Identify extended moves likely near exhaustion (e.g. <code>run_percentile &gt;= 90</code>).</li> <li>Focus on early trend phases with possible continuation (e.g. <code>run_percentile &lt;= 25</code>).</li> <li>Filter mid-maturity setups (e.g. 40\u201370%) for balanced risk/reward.</li> <li>Combine with <code>--changed-only</code> to differentiate fresh flips vs. mature continuations.</li> </ul>"},{"location":"api/heiken_runs/#function-reference","title":"Function Reference","text":"<pre><code>from stockcharts.indicators.heiken_runs import compute_ha_run_stats\n\nstats = compute_ha_run_stats(ha_df)\nprint(stats)\n# {'run_length': 6, 'run_percentile': 92.3, 'run_color': 'green', 'total_runs': 57}\n</code></pre>"},{"location":"api/heiken_runs/#compute_ha_run_statsha_df-dict","title":"<code>compute_ha_run_stats(ha_df) -&gt; dict</code>","text":"<p>Parameters: - <code>ha_df</code>: DataFrame containing Heiken Ashi candles with at least <code>HA_Open</code> and <code>HA_Close</code> columns.</p> <p>Returns keys: - <code>run_length</code> (int): Current contiguous same-color length. - <code>run_percentile</code> (float): Maturity percentile (0\u2013100 inclusive). - <code>run_color</code> (str): Current run color (<code>'green'</code> or <code>'red'</code>). - <code>total_runs</code> (int): Number of completed + current runs in sample.</p>"},{"location":"api/heiken_runs/#notes","title":"Notes","text":"<ul> <li>Expand <code>--lookback</code> for more stable percentile estimates.</li> <li>Very short datasets (&lt; ~30 bars) yield coarse distributions.</li> <li>Percentile can be identical for multiple run lengths if distribution is sparse.</li> <li>Use alongside price/volume filters for higher-quality signals.</li> </ul>"},{"location":"api/heiken_runs/#cli-integration","title":"CLI Integration","text":"<p><code>stockcharts-screen</code> adds two filters: - <code>--min-run-percentile PCT</code> (include runs with percentile &gt;= PCT) - <code>--max-run-percentile PCT</code> (include runs with percentile &lt;= PCT)</p> <p>CSV output columns (added): - <code>run_length</code> - <code>run_percentile</code></p> <p>Example:</p> <pre><code>stockcharts-screen --min-run-percentile 90 --period 1d --output extended_runs.csv\nstockcharts-screen --max-run-percentile 25 --period 1d --output early_runs.csv\n</code></pre>"},{"location":"api/heiken_runs/#interpretation-guidelines","title":"Interpretation Guidelines","text":"Percentile Range Context Typical Action 90\u2013100 Extended trend Watch for exhaustion / divergences 60\u201380 Mature move Monitor; tighten risk 40\u201360 Mid-phase Neutral; await confirmation 20\u201340 Emerging Potential continuation setups 0\u201310 Fresh flip Early, higher momentum potential"},{"location":"api/heiken_runs/#caveats","title":"Caveats","text":"<ul> <li>Long runs can extend further; percentile is not a reversal guarantee.</li> <li>Combine with RSI divergence for higher-conviction counter-trend entries.</li> <li>Data gaps or illiquid tickers can distort run distributions\u2014filter by volume.</li> </ul>"},{"location":"api/heiken_runs/#related-modules","title":"Related Modules","text":"<ul> <li>Heiken Ashi construction: <code>stockcharts.charts.heiken_ashi</code></li> <li>Screener integration: <code>stockcharts.screener.screener</code></li> <li>RSI divergence: <code>stockcharts.indicators.divergence</code></li> </ul>"},{"location":"api/pivots/","title":"Pivot Detection","text":""},{"location":"api/pivots/#stockcharts.indicators.pivots","title":"<code>pivots</code>","text":"<p>Pivot extraction utilities (EMA-derivative based).</p> Public API <p>ema_derivative_pivots(df: pd.DataFrame, ...) -&gt; dict</p> <p>Returns pivot indices for price &amp; RSI along with metadata.</p>"},{"location":"api/pivots/#stockcharts.indicators.pivots.ema_derivative_pivots","title":"<code>ema_derivative_pivots(df, price_col='Close', rsi_col='RSI', price_span=5, rsi_span=5)</code>","text":"<p>Detect pivot highs/lows via sign changes in first derivative of EMA-smoothed series.</p> Method <ol> <li>Smooth price &amp; RSI with EMA.</li> <li>Compute first difference (derivative).</li> <li>Identify sign-change points as pivots:<ul> <li>Pivot Low: derivative &lt; 0 then &gt; 0.</li> <li>Pivot High: derivative &gt; 0 then &lt; 0.</li> </ul> </li> </ol> <p>Parameters:</p> Name Type Description Default <code>df</code> <code>DataFrame</code> <p>DataFrame containing at least <code>price_col</code> and <code>rsi_col</code>.</p> required <code>price_col</code> <code>str</code> <p>Price column name (default \"Close\").</p> <code>'Close'</code> <code>rsi_col</code> <code>str</code> <p>RSI column name (default \"RSI\").</p> <code>'RSI'</code> <code>price_span</code> <code>int</code> <p>EMA span for price smoothing.</p> <code>5</code> <code>rsi_span</code> <code>int</code> <p>EMA span for RSI smoothing.</p> <code>5</code> <p>Returns:</p> Type Description <code>dict[str, Any]</code> <p>Dict with keys: <code>price_highs</code>, <code>price_lows</code>, <code>rsi_highs</code>, <code>rsi_lows</code>, <code>meta</code>.</p> <code>dict[str, Any]</code> <p><code>meta</code> includes method name and counts.</p> Source code in <code>src/stockcharts/indicators/pivots.py</code> <pre><code>def ema_derivative_pivots(\n    df: pd.DataFrame,\n    price_col: str = \"Close\",\n    rsi_col: str = \"RSI\",\n    price_span: int = 5,\n    rsi_span: int = 5,\n) -&gt; dict[str, Any]:\n    \"\"\"Detect pivot highs/lows via sign changes in first derivative of EMA-smoothed series.\n\n    Method:\n        1. Smooth price &amp; RSI with EMA.\n        2. Compute first difference (derivative).\n        3. Identify sign-change points as pivots:\n            - Pivot Low: derivative &lt; 0 then &gt; 0.\n            - Pivot High: derivative &gt; 0 then &lt; 0.\n\n    Args:\n        df: DataFrame containing at least ``price_col`` and ``rsi_col``.\n        price_col: Price column name (default \"Close\").\n        rsi_col: RSI column name (default \"RSI\").\n        price_span: EMA span for price smoothing.\n        rsi_span: EMA span for RSI smoothing.\n\n    Returns:\n        Dict with keys: ``price_highs``, ``price_lows``, ``rsi_highs``, ``rsi_lows``, ``meta``.\n        ``meta`` includes method name and counts.\n    \"\"\"\n    if price_col not in df.columns or rsi_col not in df.columns:\n        return {\n            \"price_highs\": pd.Index([]),\n            \"price_lows\": pd.Index([]),\n            \"rsi_highs\": pd.Index([]),\n            \"rsi_lows\": pd.Index([]),\n            \"meta\": {\"method\": \"ema-deriv\", \"error\": \"Missing required columns\"},\n        }\n\n    price_smoothed = _ema(df[price_col], price_span)\n    rsi_smoothed = _ema(df[rsi_col], rsi_span)\n\n    price_derivative = price_smoothed.diff()\n    rsi_derivative = rsi_smoothed.diff()\n\n    price_lows = price_smoothed[(price_derivative.shift(1) &lt; 0) &amp; (price_derivative &gt; 0)].index\n    price_highs = price_smoothed[(price_derivative.shift(1) &gt; 0) &amp; (price_derivative &lt; 0)].index\n    rsi_lows = rsi_smoothed[(rsi_derivative.shift(1) &lt; 0) &amp; (rsi_derivative &gt; 0)].index\n    rsi_highs = rsi_smoothed[(rsi_derivative.shift(1) &gt; 0) &amp; (rsi_derivative &lt; 0)].index\n\n    return {\n        \"price_highs\": price_highs,\n        \"price_lows\": price_lows,\n        \"rsi_highs\": rsi_highs,\n        \"rsi_lows\": rsi_lows,\n        \"meta\": {\n            \"method\": \"ema-deriv\",\n            \"price_span\": price_span,\n            \"rsi_span\": rsi_span,\n            \"price_pivots\": len(price_highs) + len(price_lows),\n            \"rsi_pivots\": len(rsi_highs) + len(rsi_lows),\n        },\n    }\n</code></pre>"},{"location":"api/pivots/#ema-derivative-method-merged-guide","title":"EMA-Derivative Method (Merged Guide)","text":"<p>Replaces earlier ZigZag approach for cleaner, parameter-light pivot extraction.</p>"},{"location":"api/pivots/#logic","title":"Logic","text":"<ol> <li>Smooth series with EMA (price &amp; RSI).</li> <li>Compute first derivative (rate of change).</li> <li>Sign change identifies pivot (negative\u2192positive = low, positive\u2192negative = high).</li> </ol>"},{"location":"api/pivots/#advantages","title":"Advantages","text":"<ul> <li>Minimal parameters (span only).</li> <li>Robust against noise.</li> <li>Symmetric application to price &amp; RSI.</li> <li>Linear complexity.</li> </ul>"},{"location":"api/pivots/#span-selection","title":"Span Selection","text":"Span Sensitivity Use Case 3-4 High Intraday/fast scans 5-6 Balanced Swing trading (default) 7-9 Smooth Position trading 10+ Very Smooth Major turns only"},{"location":"api/pivots/#cli-flags","title":"CLI Flags","text":"<pre><code>--pivot-method ema-deriv --ema-price-span N --ema-rsi-span N\n</code></pre>"},{"location":"api/pivots/#example","title":"Example","text":"<pre><code>stockcharts-rsi-divergence --type bullish --pivot-method ema-deriv --ema-price-span 7 --ema-rsi-span 7\n</code></pre>"},{"location":"api/pivots/#future-enhancements","title":"Future Enhancements","text":"<p>Adaptive spans, derivative thresholding, multi-span confirmation.</p>"},{"location":"api/rsi/","title":"RSI Indicator","text":""},{"location":"api/rsi/#stockcharts.indicators.rsi","title":"<code>rsi</code>","text":"<p>RSI (Relative Strength Index) calculation module.</p> Public API <p>compute_rsi(close: pd.Series, period: int = 14) -&gt; pd.Series</p>"},{"location":"api/rsi/#stockcharts.indicators.rsi.compute_rsi","title":"<code>compute_rsi(close, period=14)</code>","text":"<p>Compute Relative Strength Index (RSI).</p> <p>RSI = 100 - (100 / (1 + RS)) where RS = Average Gain / Average Loss.</p> <p>Parameters:</p> Name Type Description Default <code>close</code> <code>Series</code> <p>Series of closing prices.</p> required <code>period</code> <code>int</code> <p>Lookback period length (must be &gt;=1, default 14).</p> <code>14</code> <p>Returns:</p> Type Description <code>Series</code> <p>Series of RSI values in range [0,100]. NaN values where insufficient history.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If <code>period</code> &lt; 1.</p> Source code in <code>src/stockcharts/indicators/rsi.py</code> <pre><code>def compute_rsi(close: pd.Series, period: int = 14) -&gt; pd.Series:\n    \"\"\"Compute Relative Strength Index (RSI).\n\n    RSI = 100 - (100 / (1 + RS)) where RS = Average Gain / Average Loss.\n\n    Args:\n        close: Series of closing prices.\n        period: Lookback period length (must be &gt;=1, default 14).\n\n    Returns:\n        Series of RSI values in range [0,100]. NaN values where insufficient history.\n\n    Raises:\n        ValueError: If ``period`` &lt; 1.\n    \"\"\"\n    if period &lt; 1:\n        raise ValueError(\"period must be &gt;= 1\")\n\n    if len(close) &lt; period + 1:\n        # Not enough data to seed RSI calculation: return NaNs aligned to index\n        return pd.Series([pd.NA] * len(close), index=close.index, dtype=\"Float64\")\n\n    # Price changes\n    delta = close.diff()\n\n    # Gains &amp; losses separated\n    gain = delta.where(delta &gt; 0, 0.0)\n    loss = -delta.where(delta &lt; 0, 0.0)\n\n    # EWMA averages (EWM chosen for smoother adaptation)\n    avg_gain = gain.ewm(com=period - 1, min_periods=period).mean()\n    avg_loss = loss.ewm(com=period - 1, min_periods=period).mean()\n\n    rs = avg_gain / avg_loss\n    rsi = 100 - (100 / (1 + rs))\n    return rsi.astype(float)\n</code></pre>"},{"location":"api/screener/","title":"Screener Functions","text":""},{"location":"api/screener/#rsi-divergence-screening","title":"RSI Divergence Screening","text":""},{"location":"api/screener/#stockcharts.screener.rsi_divergence","title":"<code>rsi_divergence</code>","text":"<p>RSI Divergence screener for NASDAQ stocks.</p> <p>Screens stocks for RSI divergences (bullish and bearish) with configurable detection parameters, breakout filtering, and flexible pivot detection methods.</p>"},{"location":"api/screener/#stockcharts.screener.rsi_divergence.RSIDivergenceResult","title":"<code>RSIDivergenceResult</code>  <code>dataclass</code>","text":"<p>Result from RSI divergence screening.</p> <p>Attributes:</p> Name Type Description <code>ticker</code> <code>str</code> <p>Stock symbol.</p> <code>company_name</code> <code>str</code> <p>Company name from NASDAQ listing.</p> <code>close_price</code> <code>float</code> <p>Most recent close price.</p> <code>rsi</code> <code>float</code> <p>Current RSI value.</p> <code>divergence_type</code> <code>str</code> <p>Type detected ('bullish', 'bearish', or 'both').</p> <code>bullish_divergence</code> <code>bool</code> <p>True if bullish divergence detected.</p> <code>bearish_divergence</code> <code>bool</code> <p>True if bearish divergence detected.</p> <code>details</code> <code>str</code> <p>Human-readable description of divergence.</p> <code>bullish_indices</code> <code>Optional[tuple]</code> <p>Tuple of (p1_idx, p2_idx, r1_idx, r2_idx) for bullish.</p> <code>bearish_indices</code> <code>Optional[tuple]</code> <p>Tuple of (p1_idx, p2_idx, r1_idx, r2_idx) for bearish.</p> Source code in <code>src/stockcharts/screener/rsi_divergence.py</code> <pre><code>@dataclass\nclass RSIDivergenceResult:\n    \"\"\"Result from RSI divergence screening.\n\n    Attributes:\n        ticker: Stock symbol.\n        company_name: Company name from NASDAQ listing.\n        close_price: Most recent close price.\n        rsi: Current RSI value.\n        divergence_type: Type detected ('bullish', 'bearish', or 'both').\n        bullish_divergence: True if bullish divergence detected.\n        bearish_divergence: True if bearish divergence detected.\n        details: Human-readable description of divergence.\n        bullish_indices: Tuple of (p1_idx, p2_idx, r1_idx, r2_idx) for bullish.\n        bearish_indices: Tuple of (p1_idx, p2_idx, r1_idx, r2_idx) for bearish.\n    \"\"\"\n\n    ticker: str\n    company_name: str\n    close_price: float\n    rsi: float\n    divergence_type: str  # 'bullish', 'bearish', or 'both'\n    bullish_divergence: bool\n    bearish_divergence: bool\n    details: str\n    bullish_indices: Optional[tuple] = None  # (p1_idx, p2_idx, r1_idx, r2_idx)\n    bearish_indices: Optional[tuple] = None  # (p1_idx, p2_idx, r1_idx, r2_idx)\n</code></pre>"},{"location":"api/screener/#stockcharts.screener.rsi_divergence.screen_rsi_divergence","title":"<code>screen_rsi_divergence(tickers=None, period='3mo', interval='1d', rsi_period=14, divergence_type='all', min_price=None, max_price=None, min_volume=None, swing_window=5, lookback=60, start=None, end=None, exclude_breakouts=False, breakout_threshold=0.05, exclude_failed_breakouts=False, failed_lookback_window=10, failed_attempt_threshold=0.03, failed_reversal_threshold=0.01, min_swing_points=2, index_proximity_factor=2, sequence_tolerance_pct=0.002, rsi_sequence_tolerance=0.0, pivot_method='swing', zigzag_pct=0.03, zigzag_atr_mult=2.0, zigzag_atr_period=14, ema_price_span=5, ema_rsi_span=5, use_sequence_scoring=False, min_sequence_score=1.0, max_bar_gap=10, min_magnitude_atr_mult=0.5, atr_period=14, batch_size=50, verbose=True)</code>","text":"<p>Screen stocks for RSI divergences.</p> <p>Parameters:</p> Name Type Description Default <code>tickers</code> <code>list[str] | None</code> <p>List of ticker symbols (if None, uses all NASDAQ)</p> <code>None</code> <code>period</code> <code>str</code> <p>Historical period breadth for yfinance (e.g. '1mo', '3mo', '6mo', '1y') ignored if both start &amp; end provided.</p> <code>'3mo'</code> <code>interval</code> <code>str</code> <p>Candle aggregation interval ('1d','1wk','1mo').</p> <code>'1d'</code> <code>start</code> <code>Optional[str]</code> <p>Start date for historical data (YYYY-MM-DD format).</p> <code>None</code> <code>end</code> <code>Optional[str]</code> <p>End date for historical data (YYYY-MM-DD format).</p> <code>None</code> <code>rsi_period</code> <code>int</code> <p>RSI calculation period (default: 14)</p> <code>14</code> <code>divergence_type</code> <code>str</code> <p>Type to screen for ('bullish', 'bearish', or 'all')</p> <code>'all'</code> <code>min_price</code> <code>Optional[float]</code> <p>Minimum stock price filter</p> <code>None</code> <code>max_price</code> <code>Optional[float]</code> <p>Maximum stock price filter</p> <code>None</code> <code>min_volume</code> <code>Optional[float]</code> <p>Minimum average daily volume filter</p> <code>None</code> <code>swing_window</code> <code>int</code> <p>Window for swing point detection (default: 5)</p> <code>5</code> <code>lookback</code> <code>int</code> <p>Bars to look back for divergence (default: 60)</p> <code>60</code> <code>exclude_breakouts</code> <code>bool</code> <p>If True, filter out divergences where breakout already occurred</p> <code>False</code> <code>breakout_threshold</code> <code>float</code> <p>% move required to consider breakout complete (default: 0.05 = 5%)</p> <code>0.05</code> <code>exclude_failed_breakouts</code> <code>bool</code> <p>If True, filter out divergences with failed breakout attempts</p> <code>False</code> <code>failed_lookback_window</code> <code>int</code> <p>Bars to check for failed breakout (default: 10)</p> <code>10</code> <code>failed_attempt_threshold</code> <code>float</code> <p>% move to consider breakout \"attempted\" (default: 0.03 = 3%)</p> <code>0.03</code> <code>failed_reversal_threshold</code> <code>float</code> <p>% from divergence to consider \"failed\" (default: 0.01 = 1%)</p> <code>0.01</code> <code>min_swing_points</code> <code>int</code> <p>Minimum swing points required (2 or 3, default: 2)</p> <code>2</code> <code>index_proximity_factor</code> <code>int</code> <p>Multiplier for swing_window to allow bar index gap (default: 2)</p> <code>2</code> <code>sequence_tolerance_pct</code> <code>float</code> <p>Relative tolerance for 3-point price sequences (default: 0.002 = 0.2%)</p> <code>0.002</code> <code>rsi_sequence_tolerance</code> <code>float</code> <p>Extra RSI tolerance in points for 3-point sequences (default: 0.0)</p> <code>0.0</code> <code>pivot_method</code> <code>str</code> <p>Pivot detection method - 'swing' or 'ema-deriv' (default: 'swing')</p> <code>'swing'</code> <code>zigzag_pct</code> <code>float</code> <p>Percentage threshold for zigzag-pct method (default: 0.03 = 3%) [DEPRECATED]</p> <code>0.03</code> <code>zigzag_atr_mult</code> <code>float</code> <p>ATR multiplier for zigzag-atr method (default: 2.0) [DEPRECATED]</p> <code>2.0</code> <code>zigzag_atr_period</code> <code>int</code> <p>ATR period for zigzag-atr method (default: 14) [DEPRECATED]</p> <code>14</code> <code>ema_price_span</code> <code>int</code> <p>EMA smoothing span for price when using ema-deriv (default: 5)</p> <code>5</code> <code>ema_rsi_span</code> <code>int</code> <p>EMA smoothing span for RSI when using ema-deriv (default: 5)</p> <code>5</code> <code>use_sequence_scoring</code> <code>bool</code> <p>Enable ATR-normalized 3-point scoring (default: False)</p> <code>False</code> <code>min_sequence_score</code> <code>float</code> <p>Minimum score to accept a 3-point sequence (default: 1.0)</p> <code>1.0</code> <code>max_bar_gap</code> <code>int</code> <p>Max bar distance between price and RSI pivots for scoring (default: 10)</p> <code>10</code> <code>min_magnitude_atr_mult</code> <code>float</code> <p>Min price move as ATR multiple for scoring (default: 0.5)</p> <code>0.5</code> <code>atr_period</code> <code>int</code> <p>ATR period for magnitude filtering (default: 14)</p> <code>14</code> <code>batch_size</code> <code>int | None</code> <p>Number of tickers to download per batch (default: 50). Uses yfinance's built-in threading for parallel downloads. Set to None for legacy sequential download mode.</p> <code>50</code> <code>verbose</code> <code>bool</code> <p>Print progress messages (default: True)</p> <code>True</code> <p>Returns:</p> Type Description <code>list[RSIDivergenceResult]</code> <p>List of RSIDivergenceResult objects</p> Source code in <code>src/stockcharts/screener/rsi_divergence.py</code> <pre><code>def screen_rsi_divergence(\n    tickers: list[str] | None = None,\n    period: str = \"3mo\",  # Historical lookback e.g. '3mo', '6mo', '1y'\n    interval: str = \"1d\",  # Candle interval '1d','1wk','1mo'\n    rsi_period: int = 14,\n    divergence_type: str = \"all\",  # 'bullish', 'bearish', or 'all'\n    min_price: Optional[float] = None,\n    max_price: Optional[float] = None,\n    min_volume: Optional[float] = None,\n    swing_window: int = 5,\n    lookback: int = 60,\n    start: Optional[str] = None,\n    end: Optional[str] = None,\n    exclude_breakouts: bool = False,\n    breakout_threshold: float = 0.05,\n    exclude_failed_breakouts: bool = False,\n    failed_lookback_window: int = 10,\n    failed_attempt_threshold: float = 0.03,\n    failed_reversal_threshold: float = 0.01,\n    min_swing_points: int = 2,\n    index_proximity_factor: int = 2,\n    sequence_tolerance_pct: float = 0.002,\n    rsi_sequence_tolerance: float = 0.0,\n    pivot_method: str = \"swing\",\n    zigzag_pct: float = 0.03,\n    zigzag_atr_mult: float = 2.0,\n    zigzag_atr_period: int = 14,\n    ema_price_span: int = 5,\n    ema_rsi_span: int = 5,\n    use_sequence_scoring: bool = False,\n    min_sequence_score: float = 1.0,\n    max_bar_gap: int = 10,\n    min_magnitude_atr_mult: float = 0.5,\n    atr_period: int = 14,\n    batch_size: int | None = 50,\n    verbose: bool = True,\n) -&gt; list[RSIDivergenceResult]:\n    \"\"\"Screen stocks for RSI divergences.\n\n    Args:\n        tickers: List of ticker symbols (if None, uses all NASDAQ)\n        period: Historical period breadth for yfinance (e.g. '1mo', '3mo', '6mo', '1y') ignored if both start &amp; end provided.\n        interval: Candle aggregation interval ('1d','1wk','1mo').\n        start: Start date for historical data (YYYY-MM-DD format).\n        end: End date for historical data (YYYY-MM-DD format).\n        rsi_period: RSI calculation period (default: 14)\n        divergence_type: Type to screen for ('bullish', 'bearish', or 'all')\n        min_price: Minimum stock price filter\n        max_price: Maximum stock price filter\n        min_volume: Minimum average daily volume filter\n        swing_window: Window for swing point detection (default: 5)\n        lookback: Bars to look back for divergence (default: 60)\n        exclude_breakouts: If True, filter out divergences where breakout already occurred\n        breakout_threshold: % move required to consider breakout complete (default: 0.05 = 5%)\n        exclude_failed_breakouts: If True, filter out divergences with failed breakout attempts\n        failed_lookback_window: Bars to check for failed breakout (default: 10)\n        failed_attempt_threshold: % move to consider breakout \"attempted\" (default: 0.03 = 3%)\n        failed_reversal_threshold: % from divergence to consider \"failed\" (default: 0.01 = 1%)\n        min_swing_points: Minimum swing points required (2 or 3, default: 2)\n        index_proximity_factor: Multiplier for swing_window to allow bar index gap (default: 2)\n        sequence_tolerance_pct: Relative tolerance for 3-point price sequences (default: 0.002 = 0.2%)\n        rsi_sequence_tolerance: Extra RSI tolerance in points for 3-point sequences (default: 0.0)\n        pivot_method: Pivot detection method - 'swing' or 'ema-deriv' (default: 'swing')\n        zigzag_pct: Percentage threshold for zigzag-pct method (default: 0.03 = 3%) [DEPRECATED]\n        zigzag_atr_mult: ATR multiplier for zigzag-atr method (default: 2.0) [DEPRECATED]\n        zigzag_atr_period: ATR period for zigzag-atr method (default: 14) [DEPRECATED]\n        ema_price_span: EMA smoothing span for price when using ema-deriv (default: 5)\n        ema_rsi_span: EMA smoothing span for RSI when using ema-deriv (default: 5)\n        use_sequence_scoring: Enable ATR-normalized 3-point scoring (default: False)\n        min_sequence_score: Minimum score to accept a 3-point sequence (default: 1.0)\n        max_bar_gap: Max bar distance between price and RSI pivots for scoring (default: 10)\n        min_magnitude_atr_mult: Min price move as ATR multiple for scoring (default: 0.5)\n        atr_period: ATR period for magnitude filtering (default: 14)\n        batch_size: Number of tickers to download per batch (default: 50).\n            Uses yfinance's built-in threading for parallel downloads.\n            Set to None for legacy sequential download mode.\n        verbose: Print progress messages (default: True)\n\n    Returns:\n        List of RSIDivergenceResult objects\n    \"\"\"\n    if tickers is None:\n        if verbose:\n            print(\"Fetching NASDAQ ticker list...\")\n        tickers = get_nasdaq_tickers()\n        if verbose:\n            print(f\"Found {len(tickers)} tickers to screen\")\n\n    # Normalize tickers to list of strings\n    ticker_list = []\n    ticker_names = {}\n    for ticker_info in tickers:\n        if isinstance(ticker_info, tuple):\n            ticker, company_name = ticker_info\n            ticker_list.append(ticker)\n            ticker_names[ticker] = company_name\n        else:\n            ticker = str(ticker_info)\n            ticker_list.append(ticker)\n            ticker_names[ticker] = ticker\n\n    # Build divergence detection kwargs\n    divergence_kwargs = {\n        \"price_col\": \"Close\",\n        \"rsi_col\": \"RSI\",\n        \"window\": swing_window,\n        \"lookback\": lookback,\n        \"min_swing_points\": min_swing_points,\n        \"index_proximity_factor\": index_proximity_factor,\n        \"sequence_tolerance_pct\": sequence_tolerance_pct,\n        \"rsi_sequence_tolerance\": rsi_sequence_tolerance,\n        \"pivot_method\": pivot_method,\n        \"zigzag_pct\": zigzag_pct,\n        \"zigzag_atr_mult\": zigzag_atr_mult,\n        \"zigzag_atr_period\": zigzag_atr_period,\n        \"ema_price_span\": ema_price_span,\n        \"ema_rsi_span\": ema_rsi_span,\n        \"use_sequence_scoring\": use_sequence_scoring,\n        \"min_sequence_score\": min_sequence_score,\n        \"max_bar_gap\": max_bar_gap,\n        \"min_magnitude_atr_mult\": min_magnitude_atr_mult,\n        \"atr_period\": atr_period,\n    }\n\n    # Use batch or sequential mode\n    if batch_size is not None and batch_size &gt; 0:\n        results = _screen_batch_mode(\n            ticker_list=ticker_list,\n            ticker_names=ticker_names,\n            interval=interval,\n            period=period,\n            start=start,\n            end=end,\n            rsi_period=rsi_period,\n            divergence_type=divergence_type,\n            min_price=min_price,\n            max_price=max_price,\n            min_volume=min_volume,\n            exclude_breakouts=exclude_breakouts,\n            breakout_threshold=breakout_threshold,\n            exclude_failed_breakouts=exclude_failed_breakouts,\n            failed_lookback_window=failed_lookback_window,\n            failed_attempt_threshold=failed_attempt_threshold,\n            failed_reversal_threshold=failed_reversal_threshold,\n            divergence_kwargs=divergence_kwargs,\n            batch_size=batch_size,\n            verbose=verbose,\n        )\n    else:\n        results = _screen_sequential_mode(\n            ticker_list=ticker_list,\n            ticker_names=ticker_names,\n            interval=interval,\n            period=period,\n            start=start,\n            end=end,\n            rsi_period=rsi_period,\n            divergence_type=divergence_type,\n            min_price=min_price,\n            max_price=max_price,\n            min_volume=min_volume,\n            exclude_breakouts=exclude_breakouts,\n            breakout_threshold=breakout_threshold,\n            exclude_failed_breakouts=exclude_failed_breakouts,\n            failed_lookback_window=failed_lookback_window,\n            failed_attempt_threshold=failed_attempt_threshold,\n            failed_reversal_threshold=failed_reversal_threshold,\n            divergence_kwargs=divergence_kwargs,\n            verbose=verbose,\n        )\n\n    if verbose:\n        print(f\"\\nScreening complete. Found {len(results)} stocks with divergences.\")\n    return results\n</code></pre>"},{"location":"api/screener/#stockcharts.screener.rsi_divergence.save_results_to_csv","title":"<code>save_results_to_csv(results, filename='rsi_divergence_results.csv')</code>","text":"<p>Save screening results to CSV file.</p> <p>Parameters:</p> Name Type Description Default <code>results</code> <code>list[RSIDivergenceResult]</code> <p>List of RSIDivergenceResult objects to save.</p> required <code>filename</code> <code>str</code> <p>Output CSV file path.</p> <code>'rsi_divergence_results.csv'</code> <p>Returns:</p> Type Description <code>None</code> <p>None. Prints status message and writes file to disk.</p> Source code in <code>src/stockcharts/screener/rsi_divergence.py</code> <pre><code>def save_results_to_csv(\n    results: list[RSIDivergenceResult], filename: str = \"rsi_divergence_results.csv\"\n) -&gt; None:\n    \"\"\"Save screening results to CSV file.\n\n    Args:\n        results: List of RSIDivergenceResult objects to save.\n        filename: Output CSV file path.\n\n    Returns:\n        None. Prints status message and writes file to disk.\n    \"\"\"\n    if not results:\n        print(\"No results to save.\")\n        return\n\n    import json\n\n    def serialize_indices(indices: list | tuple | None) -&gt; list[str] | None:\n        \"\"\"Convert timestamp indices to ISO format strings for JSON serialization.\n\n        Args:\n            indices: Tuple of timestamp indices or None.\n\n        Returns:\n            List of ISO format date strings or None.\n        \"\"\"\n        if indices is None:\n            return None\n        return [idx.isoformat() for idx in indices]\n\n    df = pd.DataFrame(\n        [\n            {\n                \"Ticker\": r.ticker,\n                \"Company\": r.company_name,\n                \"Price\": r.close_price,\n                \"RSI\": r.rsi,\n                \"Divergence Type\": r.divergence_type,\n                \"Bullish\": r.bullish_divergence,\n                \"Bearish\": r.bearish_divergence,\n                \"Details\": r.details,\n                \"Bullish_Indices\": (\n                    json.dumps(serialize_indices(r.bullish_indices)) if r.bullish_indices else \"\"\n                ),\n                \"Bearish_Indices\": (\n                    json.dumps(serialize_indices(r.bearish_indices)) if r.bearish_indices else \"\"\n                ),\n            }\n            for r in results\n        ]\n    )\n\n    df.to_csv(filename, index=False)\n    print(f\"Results saved to {filename}\")\n</code></pre>"},{"location":"api/screener/#heiken-ashi-screening","title":"Heiken Ashi Screening","text":""},{"location":"api/screener/#stockcharts.screener.screener","title":"<code>screener</code>","text":"<p>NASDAQ Heiken Ashi screener module.</p> <p>Screens NASDAQ stocks for bullish (green) or bearish (red) Heiken Ashi patterns.</p>"},{"location":"api/screener/#stockcharts.screener.screener.ScreenResult","title":"<code>ScreenResult</code>  <code>dataclass</code>","text":"<p>Result for a single ticker Heiken Ashi screening.</p> <p>Attributes:</p> Name Type Description <code>ticker</code> <code>str</code> <p>Stock symbol.</p> <code>color</code> <code>Literal['green', 'red']</code> <p>Current candle color ('green' = bullish, 'red' = bearish).</p> <code>previous_color</code> <code>Literal['green', 'red']</code> <p>Previous candle color.</p> <code>color_changed</code> <code>bool</code> <p>True if color changed from previous candle.</p> <code>ha_open</code> <code>float</code> <p>Heiken Ashi open price.</p> <code>ha_close</code> <code>float</code> <p>Heiken Ashi close price.</p> <code>last_date</code> <code>str</code> <p>Date of the most recent candle.</p> <code>interval</code> <code>str</code> <p>Time interval used ('1d', '1wk', '1mo').</p> <code>avg_volume</code> <code>float</code> <p>Average trading volume over recent period.</p> <code>run_length</code> <code>int</code> <p>Consecutive candles of same color.</p> <code>run_percentile</code> <code>float</code> <p>Percentile rank of run length (0-100).</p> Source code in <code>src/stockcharts/screener/screener.py</code> <pre><code>@dataclass\nclass ScreenResult:\n    \"\"\"Result for a single ticker Heiken Ashi screening.\n\n    Attributes:\n        ticker: Stock symbol.\n        color: Current candle color ('green' = bullish, 'red' = bearish).\n        previous_color: Previous candle color.\n        color_changed: True if color changed from previous candle.\n        ha_open: Heiken Ashi open price.\n        ha_close: Heiken Ashi close price.\n        last_date: Date of the most recent candle.\n        interval: Time interval used ('1d', '1wk', '1mo').\n        avg_volume: Average trading volume over recent period.\n        run_length: Consecutive candles of same color.\n        run_percentile: Percentile rank of run length (0-100).\n    \"\"\"\n\n    ticker: str\n    color: Literal[\"green\", \"red\"]\n    previous_color: Literal[\"green\", \"red\"]\n    color_changed: bool\n    ha_open: float\n    ha_close: float\n    last_date: str\n    interval: str\n    avg_volume: float\n    run_length: int\n    run_percentile: float\n</code></pre>"},{"location":"api/screener/#stockcharts.screener.screener.get_candle_color","title":"<code>get_candle_color(ha_df, index=-1)</code>","text":"<p>Determine if a Heiken Ashi candle is green or red.</p> <p>Parameters:</p> Name Type Description Default <code>ha_df</code> <code>DataFrame</code> <p>Heiken Ashi DataFrame with columns HA_Open, HA_Close.</p> required <code>index</code> <code>int</code> <p>Index of the candle to check (-1 for most recent, -2 for previous).</p> <code>-1</code> <p>Returns:</p> Type Description <code>Literal['green', 'red']</code> <p>'green' if HA_Close &gt;= HA_Open (bullish), 'red' otherwise (bearish).</p> Source code in <code>src/stockcharts/screener/screener.py</code> <pre><code>def get_candle_color(ha_df: pd.DataFrame, index: int = -1) -&gt; Literal[\"green\", \"red\"]:\n    \"\"\"Determine if a Heiken Ashi candle is green or red.\n\n    Args:\n        ha_df: Heiken Ashi DataFrame with columns HA_Open, HA_Close.\n        index: Index of the candle to check (-1 for most recent, -2 for previous).\n\n    Returns:\n        'green' if HA_Close &gt;= HA_Open (bullish), 'red' otherwise (bearish).\n    \"\"\"\n    row = ha_df.iloc[index]\n    return \"green\" if row[\"HA_Close\"] &gt;= row[\"HA_Open\"] else \"red\"\n</code></pre>"},{"location":"api/screener/#stockcharts.screener.screener.screen_ticker","title":"<code>screen_ticker(ticker, period='1d', lookback=None, start=None, end=None, debug=False)</code>","text":"<p>Screen a single ticker for its latest Heiken Ashi candle color.</p> <p>Parameters:</p> Name Type Description Default <code>ticker</code> <code>str</code> <p>Stock symbol.</p> required <code>period</code> <code>str</code> <p>Aggregation period ('1d', '1wk', '1mo').</p> <code>'1d'</code> <code>lookback</code> <code>str | None</code> <p>How far back to fetch ('1mo', '3mo', '6mo', '1y', '2y', '5y', etc.).</p> <code>None</code> <code>start</code> <code>str | None</code> <p>Start date YYYY-MM-DD.</p> <code>None</code> <code>end</code> <code>str | None</code> <p>End date YYYY-MM-DD.</p> <code>None</code> <code>debug</code> <code>bool</code> <p>When True, prints detailed error information during screening.</p> <code>False</code> <p>Returns:</p> Type Description <code>ScreenResult | None</code> <p>ScreenResult or None if data unavailable or error occurs.</p> Source code in <code>src/stockcharts/screener/screener.py</code> <pre><code>def screen_ticker(\n    ticker: str,\n    period: str = \"1d\",\n    lookback: str | None = None,\n    start: str | None = None,\n    end: str | None = None,\n    debug: bool = False,\n) -&gt; ScreenResult | None:\n    \"\"\"Screen a single ticker for its latest Heiken Ashi candle color.\n\n    Args:\n        ticker: Stock symbol.\n        period: Aggregation period ('1d', '1wk', '1mo').\n        lookback: How far back to fetch ('1mo', '3mo', '6mo', '1y', '2y', '5y', etc.).\n        start: Start date YYYY-MM-DD.\n        end: End date YYYY-MM-DD.\n        debug: When True, prints detailed error information during screening.\n\n    Returns:\n        ScreenResult or None if data unavailable or error occurs.\n    \"\"\"\n    try:\n        # Fetch recent data\n        df = fetch_ohlc(ticker, interval=period, lookback=lookback, start=start, end=end)\n        return _process_ticker_dataframe(ticker, df, period, debug=debug)\n    except Exception as e:\n        if debug:\n            print(f\"  DEBUG: Error screening {ticker}: {type(e).__name__}: {e}\")\n        return None\n</code></pre>"},{"location":"api/screener/#stockcharts.screener.screener.screen_nasdaq","title":"<code>screen_nasdaq(color_filter='all', period='1d', limit=None, delay=0.5, verbose=True, changed_only=False, lookback=None, start=None, end=None, debug=False, min_volume=None, min_price=None, min_run_percentile=None, max_run_percentile=None, ticker_filter=None, batch_size=50)</code>","text":"<p>Screen NASDAQ stocks for Heiken Ashi candle colors.</p> <p>Parameters:</p> Name Type Description Default <code>color_filter</code> <code>Literal['green', 'red', 'all']</code> <p>Filter results by current candle color ('green', 'red', 'all').</p> <code>'all'</code> <code>period</code> <code>str</code> <p>Aggregation period ('1d', '1wk', '1mo').</p> <code>'1d'</code> <code>limit</code> <code>int | None</code> <p>Maximum number of tickers to screen (for testing). None = all.</p> <code>None</code> <code>delay</code> <code>float</code> <p>Delay in seconds between API calls. Only used when batch_size=None (sequential mode). Ignored when using batch downloads.</p> <code>0.5</code> <code>verbose</code> <code>bool</code> <p>Print progress messages.</p> <code>True</code> <code>changed_only</code> <code>bool</code> <p>If True, only return tickers where the candle color just changed.</p> <code>False</code> <code>lookback</code> <code>str | None</code> <p>How far back to fetch ('1mo', '3mo', '6mo', '1y', '2y', '5y', etc.).</p> <code>None</code> <code>start</code> <code>str | None</code> <p>Start date YYYY-MM-DD. Cannot be used with lookback.</p> <code>None</code> <code>end</code> <code>str | None</code> <p>End date YYYY-MM-DD. Cannot be used with lookback.</p> <code>None</code> <code>debug</code> <code>bool</code> <p>When True, enables debug output in underlying ticker screening.</p> <code>False</code> <code>min_volume</code> <code>float | None</code> <p>Minimum average daily volume (in shares).</p> <code>None</code> <code>min_price</code> <code>float | None</code> <p>Minimum stock price (in dollars).</p> <code>None</code> <code>min_run_percentile</code> <code>float | None</code> <p>Minimum run percentile (0-100). Find rare long runs.</p> <code>None</code> <code>max_run_percentile</code> <code>float | None</code> <p>Maximum run percentile (0-100). Find common short runs.</p> <code>None</code> <code>ticker_filter</code> <code>list[str] | None</code> <p>Optional list of ticker symbols to screen instead of all NASDAQ.</p> <code>None</code> <code>batch_size</code> <code>int | None</code> <p>Tickers per batch for parallel download (default: 50). Set to None for legacy sequential mode with delay.</p> <code>50</code> <p>Returns:</p> Type Description <code>list[ScreenResult]</code> <p>List of ScreenResult objects matching filters, sorted by ticker.</p> Source code in <code>src/stockcharts/screener/screener.py</code> <pre><code>def screen_nasdaq(\n    color_filter: Literal[\"green\", \"red\", \"all\"] = \"all\",\n    period: str = \"1d\",\n    limit: int | None = None,\n    delay: float = 0.5,\n    verbose: bool = True,\n    changed_only: bool = False,\n    lookback: str | None = None,\n    start: str | None = None,\n    end: str | None = None,\n    debug: bool = False,\n    min_volume: float | None = None,\n    min_price: float | None = None,\n    min_run_percentile: float | None = None,\n    max_run_percentile: float | None = None,\n    ticker_filter: list[str] | None = None,\n    batch_size: int | None = 50,\n) -&gt; list[ScreenResult]:\n    \"\"\"Screen NASDAQ stocks for Heiken Ashi candle colors.\n\n    Args:\n        color_filter: Filter results by current candle color ('green', 'red', 'all').\n        period: Aggregation period ('1d', '1wk', '1mo').\n        limit: Maximum number of tickers to screen (for testing). None = all.\n        delay: Delay in seconds between API calls. Only used when batch_size=None\n            (sequential mode). Ignored when using batch downloads.\n        verbose: Print progress messages.\n        changed_only: If True, only return tickers where the candle color just changed.\n        lookback: How far back to fetch ('1mo', '3mo', '6mo', '1y', '2y', '5y', etc.).\n        start: Start date YYYY-MM-DD. Cannot be used with lookback.\n        end: End date YYYY-MM-DD. Cannot be used with lookback.\n        debug: When True, enables debug output in underlying ticker screening.\n        min_volume: Minimum average daily volume (in shares).\n        min_price: Minimum stock price (in dollars).\n        min_run_percentile: Minimum run percentile (0-100). Find rare long runs.\n        max_run_percentile: Maximum run percentile (0-100). Find common short runs.\n        ticker_filter: Optional list of ticker symbols to screen instead of all NASDAQ.\n        batch_size: Tickers per batch for parallel download (default: 50).\n            Set to None for legacy sequential mode with delay.\n\n    Returns:\n        List of ScreenResult objects matching filters, sorted by ticker.\n    \"\"\"\n    # Use provided ticker filter or fetch all NASDAQ tickers\n    if ticker_filter is not None:\n        tickers = ticker_filter\n        if limit is not None:\n            tickers = tickers[:limit]\n    else:\n        tickers = get_nasdaq_tickers(limit=limit)\n\n    results: list[ScreenResult] = []\n\n    change_msg = \" that just changed color\" if changed_only else \"\"\n    filter_msg = \" (filtered list)\" if ticker_filter is not None else \"\"\n    mode_msg = f\"batch size {batch_size}\" if batch_size else \"sequential\"\n\n    if verbose:\n        print(\n            f\"Screening {len(tickers)} tickers{filter_msg} for {color_filter} \"\n            f\"Heiken Ashi candles{change_msg} ({period} period, {mode_msg})...\"\n        )\n        print(\"-\" * 70)\n\n    # Use batch download mode if batch_size is specified\n    if batch_size is not None and batch_size &gt; 0:\n        results = _screen_batch_mode(\n            tickers=tickers,\n            period=period,\n            lookback=lookback,\n            start=start,\n            end=end,\n            batch_size=batch_size,\n            color_filter=color_filter,\n            changed_only=changed_only,\n            min_volume=min_volume,\n            min_price=min_price,\n            min_run_percentile=min_run_percentile,\n            max_run_percentile=max_run_percentile,\n            verbose=verbose,\n            debug=debug,\n        )\n    else:\n        # Legacy sequential mode\n        results = _screen_sequential_mode(\n            tickers=tickers,\n            period=period,\n            lookback=lookback,\n            start=start,\n            end=end,\n            delay=delay,\n            color_filter=color_filter,\n            changed_only=changed_only,\n            min_volume=min_volume,\n            min_price=min_price,\n            min_run_percentile=min_run_percentile,\n            max_run_percentile=max_run_percentile,\n            verbose=verbose,\n            debug=debug,\n        )\n\n    if verbose:\n        print(\"-\" * 70)\n        print(f\"Screening complete: {len(results)} {color_filter} candles{change_msg} found\")\n\n    return sorted(results, key=lambda x: x.ticker)\n</code></pre>"}]}